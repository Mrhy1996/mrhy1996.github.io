<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Springboot启动源码分析 - mrhy&#039;s blogs</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="mrhy&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="mrhy&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="今天抽时间研究一下SpringBoot的启动过程，加深一下对springBoot的学习，啥也不说，开始整活"><meta property="og:type" content="blog"><meta property="og:title" content="Springboot启动源码分析"><meta property="og:url" content="https://mrhy1996.github.io/SpringBootApplication/"><meta property="og:site_name" content="mrhy&#039;s blogs"><meta property="og:description" content="今天抽时间研究一下SpringBoot的启动过程，加深一下对springBoot的学习，啥也不说，开始整活"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909161357981.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909162824326.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909164113322.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909164530926.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909170509935.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909171031576.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909171543309.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909171822223.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220909174522907.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220926162915438.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/SpringBoot启动源码分析/image-20220926165858282.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220926201442312.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220926202148881.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220926224753098.png"><meta property="og:image" content="https://mrhy1996.github.io/SpringBootApplication/image-20220926224909757.png"><meta property="article:published_time" content="2022-09-09T06:13:13.000Z"><meta property="article:modified_time" content="2022-09-26T14:50:06.720Z"><meta property="article:author" content="mrhy"><meta property="article:tag" content="spring"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/SpringBootApplication/image-20220909161357981.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mrhy1996.github.io/SpringBootApplication/"},"headline":"mrhy's blogs","image":["https://mrhy1996.github.io/SpringBootApplication/image-20220909161357981.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909162824326.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909164113322.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909164530926.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909170509935.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909171031576.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909171543309.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909171822223.png","https://mrhy1996.github.io/SpringBootApplication/image-20220909174522907.png","https://mrhy1996.github.io/SpringBootApplication/image-20220926162915438.png","https://mrhy1996.github.io/SpringBootApplication/SpringBoot启动源码分析/image-20220926165858282.png","https://mrhy1996.github.io/SpringBootApplication/image-20220926201442312.png","https://mrhy1996.github.io/SpringBootApplication/image-20220926202148881.png","https://mrhy1996.github.io/SpringBootApplication/image-20220926224753098.png","https://mrhy1996.github.io/SpringBootApplication/image-20220926224909757.png"],"datePublished":"2022-09-09T06:13:13.000Z","dateModified":"2022-09-26T14:50:06.720Z","author":{"@type":"Person","name":"mrhy"},"description":"今天抽时间研究一下SpringBoot的启动过程，加深一下对springBoot的学习，啥也不说，开始整活"}</script><link rel="canonical" href="https://mrhy1996.github.io/SpringBootApplication/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="mrhy&#039;s blogs" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Mrhy1996/"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-09-09T06:13:13.000Z" title="2022/9/9 14:13:13">2022-09-09</time>发表</span><span class="level-item"><time dateTime="2022-09-26T14:50:06.720Z" title="2022/9/26 22:50:06">2022-09-26</time>更新</span><span class="level-item">21 分钟读完 (大约3147个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Springboot启动源码分析</h1><div class="content"><p>今天抽时间研究一下SpringBoot的启动过程，加深一下对springBoot的学习，啥也不说，开始整活</p>
<span id="more"></span>

<p>通常我们去写一个简单的springboot应用的时候，都是如下起步</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OfficeSpringApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext run = SpringApplication.run(OfficeSpringApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们着重看一下SpringApplication.run的流程。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 入口跳转</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt; primarySource, String... args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> run(<span class="keyword">new</span> Class&lt;?&gt;[] &#123; primarySource &#125;, args);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Static helper that can be used to run a &#123;<span class="doctag">@link</span> SpringApplication&#125; from the</span></span><br><span class="line"><span class="comment">	 * specified sources using default settings and user supplied arguments.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> primarySources the primary sources to load</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> args the application arguments (usually passed from a Java main method)</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> the running &#123;<span class="doctag">@link</span> ApplicationContext&#125;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt;[] primarySources, String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SpringApplication(primarySources).run(args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>构建了一个SpringApplication的对象，primarySources是构造SpringApplication类的参数，指的要加载数据的主要来源。</p>
<h2 id="构造方法解读"><a href="#构造方法解读" class="headerlink" title="构造方法解读"></a>构造方法解读</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create a new &#123;<span class="doctag">@link</span> SpringApplication&#125; instance. The application context will load</span></span><br><span class="line"><span class="comment"> * beans from the specified primary sources (see &#123;<span class="doctag">@link</span> SpringApplication class-level&#125;</span></span><br><span class="line"><span class="comment"> * documentation for details). The instance can be customized before calling</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #run(String...)&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> primarySources the primary bean sources</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #run(Class, String[])</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #SpringApplication(ResourceLoader, Class...)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #setSources(Set)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>(<span class="keyword">null</span>, primarySources);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">	Assert.notNull(primarySources, <span class="string">&quot;PrimarySources must not be null&quot;</span>);</span><br><span class="line">	<span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));</span><br><span class="line">	<span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class="line">	<span class="keyword">this</span>.bootstrapRegistryInitializers = <span class="keyword">new</span> ArrayList&lt;&gt;(</span><br><span class="line">			getSpringFactoriesInstances(BootstrapRegistryInitializer.class));</span><br><span class="line">   <span class="comment">// 设置初始化</span></span><br><span class="line">	setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));</span><br><span class="line">   <span class="comment">// 设置监听</span></span><br><span class="line">	setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">	<span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看如上的代码，首先几个变量</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>resourceLoader</td>
<td>目前为空，资源加载器</td>
</tr>
<tr>
<td>primarySources</td>
<td>主要的来源</td>
</tr>
<tr>
<td>webApplicationType</td>
<td>web应用的类型，debug下来是SERVLET</td>
</tr>
<tr>
<td>bootstrapRegistryInitializers</td>
<td>不清楚，debug下来是空数组,因为没有这个</td>
</tr>
<tr>
<td>mainApplicationClass</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>setInitializers</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getSpringFactoriesInstances(ApplicationContextInitializer.class))</span><br><span class="line"><span class="comment">//   点进来</span></span><br><span class="line">	<span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getSpringFactoriesInstances(type, <span class="keyword">new</span> Class&lt;?&gt;[] &#123;&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args)</span> </span>&#123;</span><br><span class="line">		ClassLoader classLoader = getClassLoader();</span><br><span class="line">		<span class="comment">// Use names and ensure unique to protect against duplicates</span></span><br><span class="line">		Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</span><br><span class="line">		List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span class="line">		AnnotationAwareOrderComparator.sort(instances);</span><br><span class="line">		<span class="keyword">return</span> instances;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>研究一下<br>SpringFactoriesLoader.loadFactoryNames(type, classLoader)<br>已知 type是一个类，且此时value=interface org.springframework.context.ApplicationContextInitializer<br>classloader 是AppClassLoader<br> 进入方法   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryType, <span class="meta">@Nullable</span> ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">	ClassLoader classLoaderToUse = classLoader;</span><br><span class="line">	<span class="keyword">if</span> (classLoaderToUse == <span class="keyword">null</span>) &#123;</span><br><span class="line">		classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();</span><br><span class="line">	&#125;</span><br><span class="line">	String factoryTypeName = factoryType.getName();</span><br><span class="line">	<span class="keyword">return</span> loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>主要逻辑有两块<br>loadSpringFactories(classLoaderToUse)<br>getOrDefault(factoryTypeName, Collections.emptyList())<br>先看第一块</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(ClassLoader classLoader) &#123;</span><br><span class="line">	Map&lt;String, List&lt;String&gt;&gt; result = cache.get(classLoader);</span><br><span class="line">	<span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Enumeration&lt;URL&gt; urls = classLoader.getResources(FACTORIES_RESOURCE_LOCATION);</span><br><span class="line">		<span class="keyword">while</span> (urls.hasMoreElements()) &#123;</span><br><span class="line">			URL url = urls.nextElement();</span><br><span class="line">			UrlResource resource = <span class="keyword">new</span> UrlResource(url);</span><br><span class="line">			Properties properties = PropertiesLoaderUtils.loadProperties(resource);</span><br><span class="line">			<span class="keyword">for</span> (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;</span><br><span class="line">				String factoryTypeName = ((String) entry.getKey()).trim();</span><br><span class="line">				String[] factoryImplementationNames =</span><br><span class="line">						StringUtils.commaDelimitedListToStringArray((String) entry.getValue());</span><br><span class="line">				<span class="keyword">for</span> (String factoryImplementationName : factoryImplementationNames) &#123;</span><br><span class="line">					result.computeIfAbsent(factoryTypeName, key -&gt; <span class="keyword">new</span> ArrayList&lt;&gt;())</span><br><span class="line">							.add(factoryImplementationName.trim());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Replace all lists with unmodifiable lists containing unique elements</span></span><br><span class="line">		result.replaceAll((factoryType, implementations) -&gt; implementations.stream().distinct()</span><br><span class="line">				.collect(Collectors.collectingAndThen(Collectors.toList(), Collections::unmodifiableList)));</span><br><span class="line">		cache.put(classLoader, result);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unable to load factories from location [&quot;</span> +</span><br><span class="line">				FACTORIES_RESOURCE_LOCATION + <span class="string">&quot;]&quot;</span>, ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>已知Classloader=AppClassLoader，获取SpringFactory</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> Map&lt;ClassLoader, Map&lt;String, List&lt;String&gt;&gt;&gt; cache = <span class="keyword">new</span> ConcurrentReferenceHashMap&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>首先从缓存中拿取，如果缓存中没有则走下面的方法</p>
<img src="/SpringBootApplication/image-20220909161357981.png" class="" title="image-20220909161357981"> 

<p>读取spring.factories</p>
<img src="/SpringBootApplication/image-20220909162824326.png" class="" title="image-20220909162824326">



<p>扫描所有的spring.factories，最终缓存类如下</p>
<img src="/SpringBootApplication/image-20220909164113322.png" class="" title="image-20220909164113322">

<p>所以，综上，初始化的类有了眉目，赋值给initializers，实际上拿取的是Spring.factories中全部的写好的类</p>
<img src="/SpringBootApplication/image-20220909164530926.png" class="" title="image-20220909164530926">

<p>再次解读方法，目前就可以清楚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args)</span> </span>&#123;</span><br><span class="line">	ClassLoader classLoader = getClassLoader();</span><br><span class="line">	<span class="comment">// Use names and ensure unique to protect against duplicates</span></span><br><span class="line">	Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</span><br><span class="line">   <span class="comment">// 创建instancee示例</span></span><br><span class="line">	List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span class="line">   <span class="comment">// 排序</span></span><br><span class="line">	AnnotationAwareOrderComparator.sort(instances);</span><br><span class="line">	<span class="keyword">return</span> instances;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>// 查看一下排序规则，主要方法如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">doCompare</span><span class="params">(<span class="meta">@Nullable</span> Object o1, <span class="meta">@Nullable</span> Object o2, <span class="meta">@Nullable</span> OrderSourceProvider sourceProvider)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> p1 = (o1 <span class="keyword">instanceof</span> PriorityOrdered);</span><br><span class="line">		<span class="keyword">boolean</span> p2 = (o2 <span class="keyword">instanceof</span> PriorityOrdered);</span><br><span class="line">		<span class="keyword">if</span> (p1 &amp;&amp; !p2) &#123;</span><br><span class="line">			<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (p2 &amp;&amp; !p1) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> i1 = getOrder(o1, sourceProvider);</span><br><span class="line">		<span class="keyword">int</span> i2 = getOrder(o2, sourceProvider);</span><br><span class="line">		<span class="keyword">return</span> Integer.compare(i1, i2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">(<span class="meta">@Nullable</span> Object obj, <span class="meta">@Nullable</span> OrderSourceProvider sourceProvider)</span> </span>&#123;</span><br><span class="line">		Integer order = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (obj != <span class="keyword">null</span> &amp;&amp; sourceProvider != <span class="keyword">null</span>) &#123;</span><br><span class="line">			Object orderSource = sourceProvider.getOrderSource(obj);</span><br><span class="line">			<span class="keyword">if</span> (orderSource != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (orderSource.getClass().isArray()) &#123;</span><br><span class="line">					<span class="keyword">for</span> (Object source : ObjectUtils.toObjectArray(orderSource)) &#123;</span><br><span class="line">						order = findOrder(source);</span><br><span class="line">						<span class="keyword">if</span> (order != <span class="keyword">null</span>) &#123;</span><br><span class="line">							<span class="keyword">break</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					order = findOrder(orderSource);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (order != <span class="keyword">null</span> ? order : getOrder(obj));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">(<span class="meta">@Nullable</span> Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (obj != <span class="keyword">null</span>) &#123;</span><br><span class="line">			Integer order = findOrder(obj);</span><br><span class="line">			<span class="keyword">if</span> (order != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> order;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> Ordered.LOWEST_PRECEDENCE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Integer <span class="title">findOrder</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">		Integer order = <span class="keyword">super</span>.findOrder(obj);</span><br><span class="line">		<span class="keyword">if</span> (order != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> order;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> findOrderFromAnnotation(obj);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> Integer <span class="title">findOrder</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (obj <span class="keyword">instanceof</span> Ordered ? ((Ordered) obj).getOrder() : <span class="keyword">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>整个调用链下来，可以发现，如果实现了Order，则根据Order的顺序进行排序，如果没有，则从注解中拿取</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Integer <span class="title">findOrderFromAnnotation</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">	AnnotatedElement element = (obj <span class="keyword">instanceof</span> AnnotatedElement ? (AnnotatedElement) obj : obj.getClass());</span><br><span class="line">	MergedAnnotations annotations = MergedAnnotations.from(element, SearchStrategy.TYPE_HIERARCHY);</span><br><span class="line">	Integer order = OrderUtils.getOrderFromAnnotations(element, annotations);</span><br><span class="line">	<span class="keyword">if</span> (order == <span class="keyword">null</span> &amp;&amp; obj <span class="keyword">instanceof</span> DecoratingProxy) &#123;</span><br><span class="line">		<span class="keyword">return</span> findOrderFromAnnotation(((DecoratingProxy) obj).getDecoratedClass());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Integer <span class="title">findOrder</span><span class="params">(MergedAnnotations annotations)</span> </span>&#123;</span><br><span class="line">	MergedAnnotation&lt;Order&gt; orderAnnotation = annotations.get(Order.class);</span><br><span class="line">	<span class="keyword">if</span> (orderAnnotation.isPresent()) &#123;</span><br><span class="line">		<span class="keyword">return</span> orderAnnotation.getInt(MergedAnnotation.VALUE);</span><br><span class="line">	&#125;</span><br><span class="line">	MergedAnnotation&lt;?&gt; priorityAnnotation = annotations.get(JAVAX_PRIORITY_ANNOTATION);</span><br><span class="line">	<span class="keyword">if</span> (priorityAnnotation.isPresent()) &#123;</span><br><span class="line">		<span class="keyword">return</span> priorityAnnotation.getInt(MergedAnnotation.VALUE);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<img src="/SpringBootApplication/image-20220909170509935.png" class="" title="image-20220909170509935">

<p>按照从小到大的顺序进行排序</p>
<img src="/SpringBootApplication/image-20220909171031576.png" class="" title="image-20220909171031576">

<table>
<thead>
<tr>
<th>变量名</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>initializers</td>
<td>目前为spring.factories中写的继承ApplicationContextInitializer中的方法，并按照order的顺序进行排序</td>
</tr>
</tbody></table>
<p>解读listeners变量，代码逻辑和上述一致</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>listeners</td>
<td>目前为spring.factories中写的继承ApplicationListener中的方法，并按照order的顺序进行排序</td>
</tr>
</tbody></table>
<img src="/SpringBootApplication/image-20220909171543309.png" class="" title="image-20220909171543309">

<p>最后一个mainApplicationClass变量，我们看看干了啥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Class&lt;?&gt; deduceMainApplicationClass() &#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      StackTraceElement[] stackTrace = <span class="keyword">new</span> RuntimeException().getStackTrace();</span><br><span class="line">      <span class="keyword">for</span> (StackTraceElement stackTraceElement : stackTrace) &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="string">&quot;main&quot;</span>.equals(stackTraceElement.getMethodName())) &#123;</span><br><span class="line">            <span class="keyword">return</span> Class.forName(stackTraceElement.getClassName());</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">      <span class="comment">// Swallow and continue</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出，是获取main方法的类</p>
<img src="/SpringBootApplication/image-20220909171822223.png" class="" title="image-20220909171822223">

<p>综上，Springboot的构造方法主要初始化了如下几个变量</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>resourceLoader</td>
<td>目前为空，资源加载器</td>
</tr>
<tr>
<td>primarySources</td>
<td>主要的来源</td>
</tr>
<tr>
<td>webApplicationType</td>
<td>web应用的类型，debug下来是SERVLET</td>
</tr>
<tr>
<td>bootstrapRegistryInitializers</td>
<td>不清楚，debug下来是空数组,因为没有这个</td>
</tr>
<tr>
<td>mainApplicationClass</td>
<td>主类，标识谁去加载Spring</td>
</tr>
<tr>
<td>initializers</td>
<td>目前为spring.factories中写的继承ApplicationContextInitializer中的方法，并按照order的顺序进行排序</td>
</tr>
<tr>
<td>listeners</td>
<td>目前为spring.factories中写的继承ApplicationListener中的方法，并按照order的顺序进行排序</td>
</tr>
</tbody></table>
<h2 id="run方法解读"><a href="#run方法解读" class="headerlink" title="run方法解读"></a>run方法解读</h2><p>当SpringApplication这个对象被初始化后，开始执行run方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Run the Spring application, creating and refreshing a new</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ApplicationContext&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args the application arguments (usually passed from a Java main method)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a running &#123;<span class="doctag">@link</span> ApplicationContext&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">long</span> startTime = System.nanoTime();</span><br><span class="line">	DefaultBootstrapContext bootstrapContext = createBootstrapContext();</span><br><span class="line">	ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">	configureHeadlessProperty();</span><br><span class="line">	SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">	listeners.starting(bootstrapContext, <span class="keyword">this</span>.mainApplicationClass);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">		ConfigurableEnvironment environment = prepareEnvironment(listeners, bootstrapContext, applicationArguments);</span><br><span class="line">		configureIgnoreBeanInfo(environment);</span><br><span class="line">		Banner printedBanner = printBanner(environment);</span><br><span class="line">		context = createApplicationContext();</span><br><span class="line">		context.setApplicationStartup(<span class="keyword">this</span>.applicationStartup);</span><br><span class="line">		prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">		refreshContext(context);</span><br><span class="line">		afterRefresh(context, applicationArguments);</span><br><span class="line">		Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">			<span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);</span><br><span class="line">		&#125;</span><br><span class="line">		listeners.started(context, timeTakenToStartup);</span><br><span class="line">		callRunners(context, applicationArguments);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">		handleRunFailure(context, ex, listeners);</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Duration timeTakenToReady = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">		listeners.ready(context, timeTakenToReady);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">		handleRunFailure(context, ex, <span class="keyword">null</span>);</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第一个变量"><a href="#第一个变量" class="headerlink" title="第一个变量"></a>第一个变量</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DefaultBootstrapContext bootstrapContext = createBootstrapContext();</span><br><span class="line"><span class="function"><span class="keyword">private</span> DefaultBootstrapContext <span class="title">createBootstrapContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	DefaultBootstrapContext bootstrapContext = <span class="keyword">new</span> DefaultBootstrapContext();</span><br><span class="line">	<span class="keyword">this</span>.bootstrapRegistryInitializers.forEach((initializer) -&gt; initializer.initialize(bootstrapContext));</span><br><span class="line">	<span class="keyword">return</span> bootstrapContext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面我们提到bootstrapRegistryInitializers 是空数组，所以目前来看，只是new了一个对象</p>
<h3 id="configureHeadlessProperty"><a href="#configureHeadlessProperty" class="headerlink" title="configureHeadlessProperty"></a>configureHeadlessProperty</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">configureHeadlessProperty();</span><br><span class="line">SYSTEM_PROPERTY_JAVA_AWT_HEADLESS</span><br><span class="line"><span class="comment">// 设置环境变量，目前作用不详，目前为true</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> headless = <span class="keyword">true</span>;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureHeadlessProperty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.setProperty(SYSTEM_PROPERTY_JAVA_AWT_HEADLESS,</span><br><span class="line">				System.getProperty(SYSTEM_PROPERTY_JAVA_AWT_HEADLESS, Boolean.toString(<span class="keyword">this</span>.headless)));</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getRunListeners"><a href="#getRunListeners" class="headerlink" title="getRunListeners"></a>getRunListeners</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getRunListeners(args)</span><br><span class="line"><span class="function"><span class="keyword">private</span> SpringApplicationRunListeners <span class="title">getRunListeners</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Class&lt;?&gt;[] types = <span class="keyword">new</span> Class&lt;?&gt;[] &#123; SpringApplication.class, String[].class &#125;;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SpringApplicationRunListeners(logger,</span><br><span class="line">				getSpringFactoriesInstances(SpringApplicationRunListener.class, types, <span class="keyword">this</span>, args),</span><br><span class="line">				<span class="keyword">this</span>.applicationStartup);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args)</span> </span>&#123;</span><br><span class="line">		ClassLoader classLoader = getClassLoader();</span><br><span class="line">		<span class="comment">// Use names and ensure unique to protect against duplicates</span></span><br><span class="line">		Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</span><br><span class="line">		List&lt;T&gt; instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span class="line">		AnnotationAwareOrderComparator.sort(instances);</span><br><span class="line">		<span class="keyword">return</span> instances;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<p>getSpringFactoriesInstances 方法咱们分析过，这里是获取继承SpringApplicationRunListener接口的实例，并按照实例的order进行排序</p>
<img src="/SpringBootApplication/image-20220909174522907.png" class="" title="image-20220909174522907">

<p>那看一下 new SpringApplicationRunListeners 这个构造方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SpringApplicationRunListeners(Log log, Collection&lt;? extends SpringApplicationRunListener&gt; listeners,</span><br><span class="line">		ApplicationStartup applicationStartup) &#123;</span><br><span class="line">	<span class="keyword">this</span>.log = log;</span><br><span class="line">	<span class="keyword">this</span>.listeners = <span class="keyword">new</span> ArrayList&lt;&gt;(listeners);</span><br><span class="line">	<span class="keyword">this</span>.applicationStartup = applicationStartup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>变量名</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>log</td>
<td>目前为空</td>
</tr>
<tr>
<td>listeners</td>
<td>只有一个eventPublishingRunListener</td>
</tr>
<tr>
<td>applicationStartup</td>
<td>走的默认，默认为 ApplicationStartup.DEFAULT  DefaultApplicationStartup</td>
</tr>
</tbody></table>
<h3 id="listeners-starting-bootstrapContext-this-mainApplicationClass-todo-作用"><a href="#listeners-starting-bootstrapContext-this-mainApplicationClass-todo-作用" class="headerlink" title="listeners.starting(bootstrapContext, this.mainApplicationClass) todo 作用;"></a>listeners.starting(bootstrapContext, this.mainApplicationClass) todo 作用;</h3><p>监听者开始干活，分析一下代码干了什么</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">starting</span><span class="params">(ConfigurableBootstrapContext bootstrapContext, Class&lt;?&gt; mainApplicationClass)</span> </span>&#123;</span><br><span class="line">	doWithListeners(<span class="string">&quot;spring.boot.application.starting&quot;</span>, (listener) -&gt; listener.starting(bootstrapContext),</span><br><span class="line">			(step) -&gt; &#123;</span><br><span class="line">				<span class="keyword">if</span> (mainApplicationClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">					step.tag(<span class="string">&quot;mainApplicationClass&quot;</span>, mainApplicationClass.getName());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWithListeners</span><span class="params">(String stepName, Consumer&lt;SpringApplicationRunListener&gt; listenerAction,</span></span></span><br><span class="line"><span class="function"><span class="params">		Consumer&lt;StartupStep&gt; stepAction)</span> </span>&#123;</span><br><span class="line">	StartupStep step = <span class="keyword">this</span>.applicationStartup.start(stepName);</span><br><span class="line">	<span class="keyword">this</span>.listeners.forEach(listenerAction);</span><br><span class="line">	<span class="keyword">if</span> (stepAction != <span class="keyword">null</span>) &#123;</span><br><span class="line">		stepAction.accept(step);</span><br><span class="line">	&#125;</span><br><span class="line">	step.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此处可以复习一下consumer的知识，具体参考文章可以如下：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1488128">https://cloud.tencent.com/developer/article/1488128</a></p>
<h4 id="第一个参数"><a href="#第一个参数" class="headerlink" title="第一个参数"></a>第一个参数</h4><p>此处只要是调用doWithListeners方法，实现的功能是，调用 DefaultApplicationStartup 的start方法，如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultStartupStep DEFAULT_STARTUP_STEP = <span class="keyword">new</span> DefaultStartupStep();</span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultStartupStep <span class="title">start</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> DEFAULT_STARTUP_STEP;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>this.listeners.forEach(listenerAction)作用是，eventPublishingRunListener 调用starting方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> SimpleApplicationEventMulticaster initialMulticaster;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">EventPublishingRunListener</span><span class="params">(SpringApplication application, String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.application = application;</span><br><span class="line">		<span class="keyword">this</span>.args = args;</span><br><span class="line">		<span class="keyword">this</span>.initialMulticaster = <span class="keyword">new</span> SimpleApplicationEventMulticaster();</span><br><span class="line">		<span class="keyword">for</span> (ApplicationListener&lt;?&gt; listener : application.getListeners()) &#123;</span><br><span class="line">			<span class="keyword">this</span>.initialMulticaster.addApplicationListener(listener);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">starting</span><span class="params">(ConfigurableBootstrapContext bootstrapContext)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.initialMulticaster</span><br><span class="line">				.multicastEvent(<span class="keyword">new</span> ApplicationStartingEvent(bootstrapContext, <span class="keyword">this</span>.application, <span class="keyword">this</span>.args));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multicastEvent</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">		multicastEvent(event, resolveDefaultEventType(event));</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">// 此处的event类型是ApplicationStartingEvent</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multicastEvent</span><span class="params">(<span class="keyword">final</span> ApplicationEvent event, <span class="meta">@Nullable</span> ResolvableType eventType)</span> </span>&#123;</span><br><span class="line">		ResolvableType type = (eventType != <span class="keyword">null</span> ? eventType : resolveDefaultEventType(event));</span><br><span class="line">		Executor executor = getTaskExecutor();</span><br><span class="line">		<span class="keyword">for</span> (ApplicationListener&lt;?&gt; listener : getApplicationListeners(event, type)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (executor != <span class="keyword">null</span>) &#123;</span><br><span class="line">				executor.execute(() -&gt; invokeListener(listener, event));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				invokeListener(listener, event);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看startting，变量只有一个initialMulticaster，查看变量如下</p>
<img src="/SpringBootApplication/image-20220926162915438.png" class="" title="image-20220926162915438">

<p>解析multicastEvent 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multicastEvent</span><span class="params">(<span class="keyword">final</span> ApplicationEvent event, <span class="meta">@Nullable</span> ResolvableType eventType)</span> </span>&#123;</span><br><span class="line">   ResolvableType type = (eventType != <span class="keyword">null</span> ? eventType : resolveDefaultEventType(event));</span><br><span class="line">  <span class="comment">// 获取线程池</span></span><br><span class="line">   Executor executor = getTaskExecutor();</span><br><span class="line">  <span class="comment">// 获取监听者</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">for</span> (ApplicationListener&lt;?&gt; listener : getApplicationListeners(event, type)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (executor != <span class="keyword">null</span>) &#123;</span><br><span class="line">         executor.execute(() -&gt; invokeListener(listener, event));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         invokeListener(listener, event);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取监听者</p>
<img src="SpringBoot启动源码分析/image-20220926165858282.png" alt="image-20220926165858282" style="zoom:50%;" />

<p>目前三个listener进行invoke，本质上是调用各自的onApplicationEvent方法,以LoggingApplicationListener为例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 此处的event全都是 ApplicationStartingEvent</span></span><br><span class="line">		<span class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationStartingEvent) &#123;</span><br><span class="line">			onApplicationStartingEvent((ApplicationStartingEvent) event);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationEnvironmentPreparedEvent) &#123;</span><br><span class="line">			onApplicationEnvironmentPreparedEvent((ApplicationEnvironmentPreparedEvent) event);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationPreparedEvent) &#123;</span><br><span class="line">			onApplicationPreparedEvent((ApplicationPreparedEvent) event);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ContextClosedEvent</span><br><span class="line">				&amp;&amp; ((ContextClosedEvent) event).getApplicationContext().getParent() == <span class="keyword">null</span>) &#123;</span><br><span class="line">			onContextClosedEvent();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationFailedEvent) &#123;</span><br><span class="line">			onApplicationFailedEvent();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onApplicationStartingEvent</span><span class="params">(ApplicationStartingEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.loggingSystem = LoggingSystem.get(event.getSpringApplication().getClassLoader());</span><br><span class="line">		<span class="keyword">this</span>.loggingSystem.beforeInitialize();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">// 可以理解为对loggingSystem进行了赋值</span></span><br><span class="line">LoggingApplicationListener</span><br><span class="line">  	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeInitialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		LoggerContext loggerContext = getLoggerContext();</span><br><span class="line">		<span class="keyword">if</span> (isAlreadyInitialized(loggerContext)) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">super</span>.beforeInitialize();</span><br><span class="line">		loggerContext.getConfiguration().addFilter(FILTER);</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<h4 id="第二个参数"><a href="#第二个参数" class="headerlink" title="第二个参数"></a>第二个参数</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">starting</span><span class="params">(ConfigurableBootstrapContext bootstrapContext, Class&lt;?&gt; mainApplicationClass)</span> </span>&#123;</span><br><span class="line">		doWithListeners(<span class="string">&quot;spring.boot.application.starting&quot;</span>, (listener) -&gt; listener.starting(bootstrapContext),</span><br><span class="line">				(step) -&gt; &#123;</span><br><span class="line">					<span class="keyword">if</span> (mainApplicationClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">						step.tag(<span class="string">&quot;mainApplicationClass&quot;</span>, mainApplicationClass.getName());</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWithListeners</span><span class="params">(String stepName, Consumer&lt;SpringApplicationRunListener&gt; listenerAction,</span></span></span><br><span class="line"><span class="function"><span class="params">			Consumer&lt;StartupStep&gt; stepAction)</span> </span>&#123;</span><br><span class="line">		StartupStep step = <span class="keyword">this</span>.applicationStartup.start(stepName);</span><br><span class="line">		<span class="keyword">this</span>.listeners.forEach(listenerAction);</span><br><span class="line">		<span class="keyword">if</span> (stepAction != <span class="keyword">null</span>) &#123;</span><br><span class="line">			stepAction.accept(step);</span><br><span class="line">		&#125;</span><br><span class="line">		step.end();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>以DefaultApplicationStartup为例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> StartupStep <span class="title">tag</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>可以理解为  啥也没做，那起比较重要作用的就是listenerAction</p>
<h3 id="prepareEnvironment"><a href="#prepareEnvironment" class="headerlink" title="prepareEnvironment"></a>prepareEnvironment</h3><p>在初始化前面有一行代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">提供对用于运行SpringApplication的参数的访问。</span></span><br><span class="line"><span class="comment">自从：</span></span><br><span class="line"><span class="comment">1.3.0</span></span><br><span class="line"><span class="comment">作者：</span></span><br><span class="line"><span class="comment">菲利普·韦伯</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DefaultApplicationArguments</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(args, <span class="string">&quot;Args must not be null&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.source = <span class="keyword">new</span> Source(args);</span><br><span class="line">		<span class="keyword">this</span>.args = args;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>获取一个ApplicationArguments对象，此时对象为</p>
<img src="/SpringBootApplication/image-20220926201442312.png" class="" title="image-20220926201442312">

<p>接下来让我们看prepareEnvironment(listeners, bootstrapContext, applicationArguments);</p>
<p>首先是看三个入参</p>
<table>
<thead>
<tr>
<th>listeners</th>
<th>只有一个eventPublishingRunListener</th>
</tr>
</thead>
<tbody><tr>
<td>bootstrapContext</td>
<td>DefaultBootstrapContext</td>
</tr>
<tr>
<td>applicationArguments</td>
<td>暂无别的</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">prepareEnvironment</span><span class="params">(SpringApplicationRunListeners listeners,</span></span></span><br><span class="line"><span class="function"><span class="params">		DefaultBootstrapContext bootstrapContext, ApplicationArguments applicationArguments)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Create and configure the environment</span></span><br><span class="line">	ConfigurableEnvironment environment = getOrCreateEnvironment();</span><br><span class="line">	configureEnvironment(environment, applicationArguments.getSourceArgs());</span><br><span class="line">	ConfigurationPropertySources.attach(environment);</span><br><span class="line">	listeners.environmentPrepared(bootstrapContext, environment);</span><br><span class="line">	DefaultPropertiesPropertySource.moveToEnd(environment);</span><br><span class="line">	Assert.state(!environment.containsProperty(<span class="string">&quot;spring.main.environment-prefix&quot;</span>),</span><br><span class="line">			<span class="string">&quot;Environment prefix cannot be set via properties.&quot;</span>);</span><br><span class="line">	bindToSpringApplication(environment);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>.isCustomEnvironment) &#123;</span><br><span class="line">		environment = convertEnvironment(environment);</span><br><span class="line">	&#125;</span><br><span class="line">	ConfigurationPropertySources.attach(environment);</span><br><span class="line">	<span class="keyword">return</span> environment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="getOrCreateEnvironment"><a href="#getOrCreateEnvironment" class="headerlink" title="getOrCreateEnvironment();"></a>getOrCreateEnvironment();</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">getOrCreateEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.environment != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.environment;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">this</span>.webApplicationType) &#123;</span><br><span class="line">	<span class="keyword">case</span> SERVLET:</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ApplicationServletEnvironment();</span><br><span class="line">	<span class="keyword">case</span> REACTIVE:</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ApplicationReactiveWebEnvironment();</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ApplicationEnvironment();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/SpringBootApplication/image-20220926202148881.png" class="" title="image-20220926202148881">

<p>返回一个新的ApplicationServletEnvironment()</p>
<h4 id="configureEnvironment-environment-applicationArguments-getSourceArgs"><a href="#configureEnvironment-environment-applicationArguments-getSourceArgs" class="headerlink" title="configureEnvironment(environment, applicationArguments.getSourceArgs());"></a>configureEnvironment(environment, applicationArguments.getSourceArgs());</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureEnvironment</span><span class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.addConversionService) &#123;</span><br><span class="line">     <span class="comment">// 默认为true</span></span><br><span class="line">		environment.setConversionService(<span class="keyword">new</span> ApplicationConversionService());</span><br><span class="line">	&#125;</span><br><span class="line">   </span><br><span class="line">	configurePropertySources(environment, args);</span><br><span class="line">	configureProfiles(environment, args);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> 在此应用程序的环境中添加、删除或重新排序任何PropertySource 。</span></span><br><span class="line"><span class="comment"> 参数：</span></span><br><span class="line"><span class="comment"> environment - 此应用程序的环境 args – 传递给run方法的参数</span></span><br><span class="line"><span class="comment"> 也可以看看：</span></span><br><span class="line"><span class="comment"> configureEnvironment(ConfigurableEnvironment, String[])</span></span><br><span class="line"><span class="comment"> 将args 给到环境中，进行加载</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configurePropertySources</span><span class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span class="line">	MutablePropertySources sources = environment.getPropertySources();</span><br><span class="line">	<span class="keyword">if</span> (!CollectionUtils.isEmpty(<span class="keyword">this</span>.defaultProperties)) &#123;</span><br><span class="line">		DefaultPropertiesPropertySource.addOrMerge(<span class="keyword">this</span>.defaultProperties, sources);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.addCommandLineProperties &amp;&amp; args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		String name = CommandLinePropertySource.COMMAND_LINE_PROPERTY_SOURCE_NAME;</span><br><span class="line">		<span class="keyword">if</span> (sources.contains(name)) &#123;</span><br><span class="line">			PropertySource&lt;?&gt; source = sources.get(name);</span><br><span class="line">			CompositePropertySource composite = <span class="keyword">new</span> CompositePropertySource(name);</span><br><span class="line">			composite.addPropertySource(</span><br><span class="line">					<span class="keyword">new</span> SimpleCommandLinePropertySource(<span class="string">&quot;springApplicationCommandLineArgs&quot;</span>, args));</span><br><span class="line">			composite.addPropertySource(source);</span><br><span class="line">			sources.replace(name, composite);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			sources.addFirst(<span class="keyword">new</span> SimpleCommandLinePropertySource(args));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureProfiles</span><span class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="listeners-environmentPrepared-bootstrapContext-environment"><a href="#listeners-environmentPrepared-bootstrapContext-environment" class="headerlink" title="listeners.environmentPrepared(bootstrapContext, environment);"></a>listeners.environmentPrepared(bootstrapContext, environment);</h4><p>分析一下，liseners还是只有EventPublishingRunListener</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">environmentPrepared</span><span class="params">(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span class="line">	doWithListeners(<span class="string">&quot;spring.boot.application.environment-prepared&quot;</span>,</span><br><span class="line">			(listener) -&gt; listener.environmentPrepared(bootstrapContext, environment));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又是熟悉的doWithListners的方法</p>
<p>这次是执行environmentPrepared</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">environmentPrepared</span><span class="params">(ConfigurableBootstrapContext bootstrapContext,</span></span></span><br><span class="line"><span class="function"><span class="params">		ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialMulticaster.multicastEvent(</span><br><span class="line">			<span class="keyword">new</span> ApplicationEnvironmentPreparedEvent(bootstrapContext, <span class="keyword">this</span>.application, <span class="keyword">this</span>.args, environment));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/SpringBootApplication/image-20220926224753098.png" class="" title="image-20220926224753098">

<img src="/SpringBootApplication/image-20220926224909757.png" class="" title="image-20220926224909757">

<p>研究一下getApplicationListeners(event, type)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Collection&lt;ApplicationListener&lt;?&gt;&gt; getApplicationListeners(</span><br><span class="line">		ApplicationEvent event, ResolvableType eventType) &#123;</span><br><span class="line"></span><br><span class="line">	Object source = event.getSource();</span><br><span class="line">	Class&lt;?&gt; sourceType = (source != <span class="keyword">null</span> ? source.getClass() : <span class="keyword">null</span>);</span><br><span class="line">	ListenerCacheKey cacheKey = <span class="keyword">new</span> ListenerCacheKey(eventType, sourceType);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Potential new retriever to populate</span></span><br><span class="line">	CachedListenerRetriever newRetriever = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Quick check for existing entry on ConcurrentHashMap</span></span><br><span class="line">	CachedListenerRetriever existingRetriever = <span class="keyword">this</span>.retrieverCache.get(cacheKey);</span><br><span class="line">	<span class="keyword">if</span> (existingRetriever == <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="comment">// Caching a new ListenerRetriever if possible</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.beanClassLoader == <span class="keyword">null</span> ||</span><br><span class="line">				(ClassUtils.isCacheSafe(event.getClass(), <span class="keyword">this</span>.beanClassLoader) &amp;&amp;</span><br><span class="line">						(sourceType == <span class="keyword">null</span> || ClassUtils.isCacheSafe(sourceType, <span class="keyword">this</span>.beanClassLoader)))) &#123;</span><br><span class="line">			newRetriever = <span class="keyword">new</span> CachedListenerRetriever();</span><br><span class="line">			existingRetriever = <span class="keyword">this</span>.retrieverCache.putIfAbsent(cacheKey, newRetriever);</span><br><span class="line">			<span class="keyword">if</span> (existingRetriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">				newRetriever = <span class="keyword">null</span>;  <span class="comment">// no need to populate it in retrieveApplicationListeners</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (existingRetriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">		Collection&lt;ApplicationListener&lt;?&gt;&gt; result = existingRetriever.getApplicationListeners();</span><br><span class="line">		<span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// If result is null, the existing retriever is not fully populated yet by another thread.</span></span><br><span class="line">		<span class="comment">// Proceed like caching wasn&#x27;t possible for this current local attempt.</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> retrieveApplicationListeners(eventType, sourceType, newRetriever);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>Springboot启动源码分析</p><p><a href="https://mrhy1996.github.io/SpringBootApplication/">https://mrhy1996.github.io/SpringBootApplication/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>mrhy</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-09-09</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-09-26</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="tags/spring/">spring</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="descartes/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">笛卡尔积工具类</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="k8s-api/"><span class="level-item">k8s的API</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "qqrezpoLCiXy7GuUQlTP2NPv-gzGzoHsz",
            appKey: "KzzUdvfOAtTpDcAF5mv9nQsm",
            placeholder: "有什么话想对我说，写下来吧~",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-26T09:50:26.000Z">2022-10-26</time></p><p class="title"><a href="jvm-runing-area/">jvm运行时数据区</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-21T07:26:53.000Z">2022-10-21</time></p><p class="title"><a href="jvm-load/">jvm类加载的过程</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-18T03:32:51.000Z">2022-10-18</time></p><p class="title"><a href="descartes/">笛卡尔积工具类</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-09-09T06:13:13.000Z">2022-09-09</time></p><p class="title"><a href="SpringBootApplication/">Springboot启动源码分析</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-07-18T05:43:10.000Z">2022-07-18</time></p><p class="title"><a href="k8s-api/">k8s的API</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2022/04/"><span class="level-start"><span class="level-item">四月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2022/01/"><span class="level-start"><span class="level-item">一月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="archives/2020/12/"><span class="level-start"><span class="level-item">十二月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="tags/JVM/"><span class="tag">JVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="tags/architect/"><span class="tag">architect</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/clickhouse/"><span class="tag">clickhouse</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/docker/"><span class="tag">docker</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="tags/es/"><span class="tag">es</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/flink/"><span class="tag">flink</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="tags/java/"><span class="tag">java</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="tags/jenkins/"><span class="tag">jenkins</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="tags/jvm/"><span class="tag">jvm</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="tags/k8s/"><span class="tag">k8s</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/kafka/"><span class="tag">kafka</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/linux/"><span class="tag">linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/log4j2/"><span class="tag">log4j2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="tags/mysql/"><span class="tag">mysql</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="tags/prometheus/"><span class="tag">prometheus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="tags/redis/"><span class="tag">redis</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="tags/spring/"><span class="tag">spring</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="tags/剑指offer/"><span class="tag">剑指offer</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="tags/基础知识点/"><span class="tag">基础知识点</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="tags/大数据/"><span class="tag">大数据</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="tags/工具/"><span class="tag">工具</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/微服务/"><span class="tag">微服务</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/排序算法/"><span class="tag">排序算法</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/源码/"><span class="tag">源码</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/算法/"><span class="tag">算法</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="tags/线上问题/"><span class="tag">线上问题</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="tags/设计模式/"><span class="tag">设计模式</span><span class="tag">16</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/daftpunktocat-thomas.gif" alt="mrhy1996"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">mrhy1996</p><p class="is-size-6 is-block">立志登山揽月</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国 · 上海</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">89</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">27</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Mrhy1996/" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Mrhy1996"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#构造方法解读"><span class="level-left"><span class="level-item">1</span><span class="level-item">构造方法解读</span></span></a></li><li><a class="level is-mobile" href="#run方法解读"><span class="level-left"><span class="level-item">2</span><span class="level-item">run方法解读</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#第一个变量"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">第一个变量</span></span></a></li><li><a class="level is-mobile" href="#configureHeadlessProperty"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">configureHeadlessProperty</span></span></a></li><li><a class="level is-mobile" href="#getRunListeners"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">getRunListeners</span></span></a></li><li><a class="level is-mobile" href="#listeners-starting-bootstrapContext-this-mainApplicationClass-todo-作用"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">listeners.starting(bootstrapContext, this.mainApplicationClass) todo 作用;</span></span></a></li><li><a class="level is-mobile" href="#prepareEnvironment"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">prepareEnvironment</span></span></a></li></ul></li></ul></div></div><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="mrhy&#039;s blogs" height="28"></a><p class="is-size-7"><span>&copy; 2022 mrhy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>