<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>redis配置文件详解 - mrhy&#039;s blogs</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="mrhy&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="mrhy&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="今天一起了解一下redis的配置文件，相当于是一个复习"><meta property="og:type" content="blog"><meta property="og:title" content="redis配置文件详解"><meta property="og:url" content="https://mrhy1996.github.io/redis-config/"><meta property="og:site_name" content="mrhy&#039;s blogs"><meta property="og:description" content="今天一起了解一下redis的配置文件，相当于是一个复习"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mrhy1996.github.io/img/og_image.png"><meta property="article:published_time" content="2021-05-14T06:19:55.000Z"><meta property="article:modified_time" content="2021-05-17T10:29:18.000Z"><meta property="article:author" content="mrhy"><meta property="article:tag" content="redis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mrhy1996.github.io/redis-config/"},"headline":"mrhy's blogs","image":["https://mrhy1996.github.io/img/og_image.png"],"datePublished":"2021-05-14T06:19:55.000Z","dateModified":"2021-05-17T10:29:18.000Z","author":{"@type":"Person","name":"mrhy"},"description":"今天一起了解一下redis的配置文件，相当于是一个复习"}</script><link rel="canonical" href="https://mrhy1996.github.io/redis-config/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="mrhy&#039;s blogs" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Mrhy1996/"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-05-14T06:19:55.000Z" title="5/14/2021, 2:19:55 PM">2021-05-14</time>发表</span><span class="level-item"><time dateTime="2021-05-17T10:29:18.000Z" title="5/17/2021, 6:29:18 PM">2021-05-17</time>更新</span><span class="level-item">1 小时读完 (大约13099个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">redis配置文件详解</h1><div class="content"><p>今天一起了解一下redis的配置文件，相当于是一个复习</p>
<span id="more"></span>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Redis configuration file example.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note that in order to read the configuration file, Redis must be</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> started with the file path as first argument:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># ./redis-server /path/to/redis.conf</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对大小写不敏感</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note on units: when memory size is needed, it is possible to specify</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it <span class="keyword">in</span> the usual form of 1k 5GB 4M and so forth:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1k =&gt; 1000 bytes</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# INCLUDES ###################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Include one or more other config files here.  This is useful <span class="keyword">if</span> you</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> have a standard template that goes to all Redis servers but also need</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to customize a few per-server settings.  Include files can include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> other files, so use this wisely.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Notice option &quot;include&quot; won&#x27;t be rewritten by command &quot;CONFIG REWRITE&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> from admin or Redis Sentinel. Since Redis always uses the last processed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> line as value of a configuration directive, you<span class="string">&#x27;d better put includes</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> at the beginning of this file to avoid overwriting config change at runtime.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If instead you are interested in using includes to override configuration</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> options, it is better to use include as the last line.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># include /path/to/local.conf</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> include /path/to/other.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# MODULES #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Load modules at startup. If the server is not able to load modules</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it will abort. It is possible to use multiple loadmodule directives.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># loadmodule /path/to/my_module.so</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> loadmodule /path/to/other_module.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# NETWORK #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, <span class="keyword">if</span> no <span class="string">&quot;bind&quot;</span> configuration directive is specified, Redis listens</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> connections from all the network interfaces available on the server.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible to listen to just one or multiple selected interfaces using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the <span class="string">&quot;bind&quot;</span> configuration directive, followed by one or more IP addresses.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Examples:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># bind 192.168.1.100 10.0.0.1</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> 127.0.0.1 ::1</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> internet, binding to all the interfaces is dangerous and will expose the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instance to everybody on the internet. So by default we uncomment the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> following <span class="built_in">bind</span> directive, that will force Redis to listen only into</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the IPv4 loopback interface address (this means Redis will be able to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> accept connections only from clients running into the same computer it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is running).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> JUST COMMENT THE FOLLOWING LINE.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line">bind 127.0.0.1 ::1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Protected mode is a layer of security protection, <span class="keyword">in</span> order to avoid that</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis instances left open on the internet are accessed and exploited.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When protected mode is on and if:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) The server is not binding explicitly to a set of addresses using the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="string">&quot;bind&quot;</span> directive.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) No password is configured.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The server only accepts connections from clients connecting from the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sockets.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default protected mode is enabled. You should disable it only if</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you are sure you want clients from other hosts to connect to Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> even <span class="keyword">if</span> no authentication is configured, nor a specific <span class="built_in">set</span> of interfaces</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are explicitly listed using the <span class="string">&quot;bind&quot;</span> directive.</span></span><br><span class="line">protected-mode yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Accept connections on the specified port, default is 6379 (IANA <span class="comment">#815344).</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If port 0 is specified Redis will not listen on a TCP socket.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 端口号</span></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP listen() backlog.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># In high requests-per-second environments you need an high backlog in order</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to avoid slow clients connections issues. Note that the Linux kernel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to get the desired effect.</span></span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Unix socket.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Specify the path for the Unix socket</span></span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> that will be used to listen <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> incoming connections. There is no default, so Redis will not listen</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on a unix socket when not specified.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># unixsocket /tmp/redis.sock</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> unixsocketperm 700</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Close the connection after a client is idle <span class="keyword">for</span> N seconds (0 to <span class="built_in">disable</span>)</span></span><br><span class="line">timeout 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP keepalive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of communication. This is useful <span class="keyword">for</span> two reasons:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) Detect dead peers.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Take the connection alive from the point of view of network</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    equipment <span class="keyword">in</span> the middle.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that to close the connection the double of the time is needed.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> On other kernels the period depends on the kernel configuration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># A reasonable value for this option is 300 seconds, which is the new</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis default starting with Redis 3.2.1.</span></span><br><span class="line">tcp-keepalive 300</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################ TLS/SSL #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, TLS/SSL is disabled. To <span class="built_in">enable</span> it, the <span class="string">&quot;tls-port&quot;</span> configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directive can be used to define TLS-listening ports. To <span class="built_in">enable</span> TLS on the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default port, use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># port 0</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-port 6379</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure a X.509 certificate and private key to use <span class="keyword">for</span> authenticating the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server to connected clients, masters or cluster peers.  These files should be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PEM formatted.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-cert-file redis.crt</span></span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-key-file redis.key</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure a DH parameters file to <span class="built_in">enable</span> Diffie-Hellman (DH) key exchange:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-dh-params-file redis.dh</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure a CA certificate(s) bundle or directory to authenticate TLS/SSL</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> clients and peers.  Redis requires an explicit configuration of at least one</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of these, and will not implicitly use the system wide configuration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-ca-cert-file ca.crt</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-ca-cert-dir /etc/ssl/certs</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, clients (including replica servers) on a TLS port are required</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to authenticate using valid client side certificates.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If &quot;no&quot; is specified, client certificates are not required and not accepted.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If <span class="string">&quot;optional&quot;</span> is specified, client certificates are accepted and must be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> valid <span class="keyword">if</span> provided, but are not required.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-auth-clients no</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-auth-clients optional</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, a Redis replica does not attempt to establish a TLS connection</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with its master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Use the following directive to enable TLS on replication links.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-replication yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, the Redis Cluster bus uses a plain TCP connection. To <span class="built_in">enable</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TLS <span class="keyword">for</span> the bus protocol, use the following directive:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-cluster yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Explicitly specify TLS versions to support. Allowed values are <span class="keyword">case</span> insensitive</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and include <span class="string">&quot;TLSv1&quot;</span>, <span class="string">&quot;TLSv1.1&quot;</span>, <span class="string">&quot;TLSv1.2&quot;</span>, <span class="string">&quot;TLSv1.3&quot;</span> (OpenSSL &gt;= 1.1.1) or</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> any combination. To <span class="built_in">enable</span> only TLSv1.2 and TLSv1.3, use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-protocols &quot;TLSv1.2 TLSv1.3&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure allowed ciphers.  See the ciphers(1ssl) manpage <span class="keyword">for</span> more information</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> about the syntax of this string.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note: this configuration applies only to &lt;= TLSv1.2.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-ciphers DEFAULT:!MEDIUM</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure allowed TLSv1.3 ciphersuites.  See the ciphers(1ssl) manpage <span class="keyword">for</span> more</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> information about the syntax of this string, and specifically <span class="keyword">for</span> TLSv1.3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ciphersuites.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-ciphersuites TLS_CHACHA20_POLY1305_SHA256</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When choosing a cipher, use the server<span class="string">&#x27;s preference instead of the client</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> preference. By default, the server follows the client<span class="string">&#x27;s preference.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-prefer-server-ciphers yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, TLS session caching is enabled to allow faster and less expensive</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> reconnections by clients that support it. Use the following directive to <span class="built_in">disable</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> caching.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-session-caching no</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change the default number of TLS sessions cached. A zero value sets the cache</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to unlimited size. The default size is 20480.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-session-cache-size 5000</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change the default timeout of cached TLS sessions. The default timeout is 300</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tls-session-cache-timeout 60</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################ GENERAL #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis does not run as a daemon. Use <span class="string">&#x27;yes&#x27;</span> <span class="keyword">if</span> you need it.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that Redis will write a pid file <span class="keyword">in</span> /usr/<span class="built_in">local</span>/var/run/redis.pid when daemonized.</span></span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you run Redis from upstart or systemd, Redis can interact with your</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> supervision tree. Options:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised no      - no supervision interaction</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised systemd - signal systemd by writing READY=1 to <span class="variable">$NOTIFY_SOCKET</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised auto    - detect upstart or systemd method based on</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                        UPSTART_JOB or NOTIFY_SOCKET environment variables</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note: these supervision methods only signal <span class="string">&quot;process is ready.&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       They <span class="keyword">do</span> not <span class="built_in">enable</span> continuous liveness pings back to your supervisor.</span></span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If a pid file is specified, Redis writes it <span class="built_in">where</span> specified at startup</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and removes it at <span class="built_in">exit</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When the server runs non daemonized, no pid file is created if none is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> specified <span class="keyword">in</span> the configuration. When the server is daemonized, the pid file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is used even <span class="keyword">if</span> not specified, defaulting to <span class="string">&quot;/usr/local/var/run/redis.pid&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Creating a pid file is best effort: if Redis is not able to create it</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nothing bad happens, the server will start and run normally.</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the server verbosity level.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This can be one of:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> debug (a lot of information, useful <span class="keyword">for</span> development/testing)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> notice (moderately verbose, what you want <span class="keyword">in</span> production probably)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the <span class="built_in">log</span> file name. Also the empty string can be used to force</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis to <span class="built_in">log</span> on the standard output. Note that <span class="keyword">if</span> you use standard</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> output <span class="keyword">for</span> logging but daemonize, logs will be sent to /dev/null</span></span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">enable</span> logging to the system logger, just <span class="built_in">set</span> <span class="string">&#x27;syslog-enabled&#x27;</span> to yes,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and optionally update the other syslog parameters to suit your needs.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> syslog-enabled no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the syslog identity.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> syslog-ident redis</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> syslog-facility local0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the number of databases. The default database is DB 0, you can select</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a different one on a per-connection basis using SELECT &lt;dbid&gt; <span class="built_in">where</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dbid is a number between 0 and <span class="string">&#x27;databases&#x27;</span>-1</span></span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis shows an ASCII art logo only when started to <span class="built_in">log</span> to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> standard output and <span class="keyword">if</span> the standard output is a TTY. Basically this means</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that normally a logo is displayed only <span class="keyword">in</span> interactive sessions.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># However it is possible to force the pre-4.0 behavior and always show a</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ASCII art logo <span class="keyword">in</span> startup logs by setting the following option to yes.</span></span><br><span class="line">always-show-logo yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### SNAPSHOTTING  ################################</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Save the DB on disk:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   save &lt;seconds&gt; &lt;changes&gt;</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   number of write operations against the DB occurred.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   In the example below the behaviour will be to save:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   after 900 sec (15 min) <span class="keyword">if</span> at least 1 key changed</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   after 300 sec (5 min) <span class="keyword">if</span> at least 10 keys changed</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   after 60 sec <span class="keyword">if</span> at least 10000 keys changed</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   It is also possible to remove all the previously configured save</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   points by adding a save directive with a single empty string argument</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   like <span class="keyword">in</span> the following example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   save &quot;&quot;</span></span></span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis will stop accepting writes <span class="keyword">if</span> RDB snapshots are enabled</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (at least one save point) and the latest background save failed.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This will make the user aware (<span class="keyword">in</span> a hard way) that data is not persisting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on disk properly, otherwise chances are that no one will notice and some</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disaster will happen.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If the background saving process will start working again Redis will</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> automatically allow writes again.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># However if you have setup your proper monitoring of the Redis server</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and persistence, you may want to <span class="built_in">disable</span> this feature so that Redis will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">continue</span> to work as usual even <span class="keyword">if</span> there are problems with disk,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> permissions, and so forth.</span></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Compress string objects using LZF when dump .rdb databases?</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For default that<span class="string">&#x27;s set to &#x27;</span>yes<span class="string">&#x27; as it&#x27;</span>s almost always a win.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you want to save some CPU <span class="keyword">in</span> the saving child <span class="built_in">set</span> it to <span class="string">&#x27;no&#x27;</span> but</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the dataset will likely be bigger <span class="keyword">if</span> you have compressible values or keys.</span></span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This makes the format more resistant to corruption but there is a performance</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hit to pay (around 10%) when saving and loading RDB files, so you can <span class="built_in">disable</span> it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> maximum performances.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># RDB files created with checksum disabled have a checksum of zero that will</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tell the loading code to skip the check.</span></span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The filename <span class="built_in">where</span> to dump the DB</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Remove RDB files used by replication <span class="keyword">in</span> instances without persistence</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> enabled. By default this option is disabled, however there are environments</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">where</span> <span class="keyword">for</span> regulations or other security concerns, RDB files persisted on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disk by masters <span class="keyword">in</span> order to feed replicas, or stored on disk by replicas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to load them <span class="keyword">for</span> the initial synchronization, should be deleted</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ASAP. Note that this option ONLY WORKS <span class="keyword">in</span> instances that have both AOF</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and RDB persistence disabled, otherwise is completely ignored.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># An alternative (and sometimes better) way to obtain the same effect is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to use diskless replication on both master and replicas instances. However</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the <span class="keyword">case</span> of replicas, diskless is not always an option.</span></span><br><span class="line">rdb-del-sync-files no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The working directory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The DB will be written inside this directory, with the filename specified</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> above using the <span class="string">&#x27;dbfilename&#x27;</span> configuration directive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The Append Only File will also be created inside this directory.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note that you must specify a directory here, not a file name.</span></span></span><br><span class="line">dir /usr/local/var/db/redis/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################ REPLICATION #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Master-Replica replication. Use replicaof to make a Redis instance a copy of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> another Redis server. A few things to understand ASAP about Redis replication.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   +------------------+      +---------------+</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   |      Master      | ---&gt; |    Replica    |</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   | (receive writes) |      |  (exact copy) |</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   +------------------+      +---------------+</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) Redis replication is asynchronous, but you can configure a master to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    stop accepting writes <span class="keyword">if</span> it appears to be not connected with at least</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    a given number of replicas.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Redis replicas are able to perform a partial resynchronization with the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    master <span class="keyword">if</span> the replication link is lost <span class="keyword">for</span> a relatively small amount of</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    time. You may want to configure the replication backlog size (see the next</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    sections of this file) with a sensible value depending on your needs.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3) Replication is automatic and does not need user intervention. After a</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    network partition replicas automatically try to reconnect to masters</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    and resynchronize with them.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the master is password protected (using the <span class="string">&quot;requirepass&quot;</span> configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directive below) it is possible to tell the replica to authenticate before</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> starting the replication synchronization process, otherwise the master will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> refuse the replica request.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># masterauth &lt;master-password&gt;</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># However this is not enough if you are using Redis ACLs (for Redis version</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6 or greater), and the default user is not capable of running the PSYNC</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> and/or other commands needed <span class="keyword">for</span> replication. In this <span class="keyword">case</span> it<span class="string">&#x27;s</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> better to configure a special user to use with replication, and specify the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> masteruser configuration as such:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># masteruser &lt;username&gt;</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When masteruser is specified, the replica will authenticate against its</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master using the new AUTH form: AUTH &lt;username&gt; &lt;password&gt;.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When a replica loses its connection with the master, or when the replication</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is still <span class="keyword">in</span> progress, the replica can act <span class="keyword">in</span> two different ways:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) if replica-serve-stale-data is set to &#x27;yes&#x27; (the default) the replica will</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    still reply to client requests, possibly with out of date data, or the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    data <span class="built_in">set</span> may just be empty <span class="keyword">if</span> this is the first synchronization.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 2) if replica-serve-stale-data is set to &#x27;no&#x27; the replica will reply with</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    an error <span class="string">&quot;SYNC with master in progress&quot;</span> to all the kind of commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    COMMAND, POST, HOST: and LATENCY.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">replica-serve-stale-data yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can configure a replica instance to accept writes or not. Writing against</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a replica instance may be useful to store some ephemeral data (because data</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> written on a replica will be easily deleted after resync with the master) but</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> may also cause problems <span class="keyword">if</span> clients are writing to it because of a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> misconfiguration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Since Redis 2.6 by default replicas are read-only.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note: read only replicas are not designed to be exposed to untrusted clients</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on the internet. It<span class="string">&#x27;s just a protection layer against misuse of the instance.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Still a <span class="built_in">read</span> only replica exports by default all the administrative commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> security of <span class="built_in">read</span> only replicas using <span class="string">&#x27;rename-command&#x27;</span> to shadow all the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> administrative / dangerous commands.</span></span><br><span class="line">replica-read-only yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication SYNC strategy: disk or socket.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># New replicas and reconnecting replicas that are not able to continue the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replication process just receiving differences, need to <span class="keyword">do</span> what is called a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;full synchronization&quot;</span>. An RDB file is transmitted from the master to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The transmission can happen in two different ways:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 file on disk. Later the file is transferred by the parent</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 process to the replicas incrementally.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Diskless: The Redis master creates a new process that directly writes the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">              RDB file to replica sockets, without touching the disk at all.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># With disk-backed replication, while the RDB file is generated, more replicas</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> can be queued and served with the RDB file as soon as the current child</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> producing the RDB file finishes its work. With diskless replication instead</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> once the transfer starts, new replicas arriving will be queued and a new</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> transfer will start when the current one terminates.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When diskless replication is used, the master waits a configurable amount of</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> time (<span class="keyword">in</span> seconds) before starting the transfer <span class="keyword">in</span> the hope that multiple</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas will arrive and the transfer can be parallelized.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># With slow disks and fast (large bandwidth) networks, diskless replication</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> works better.</span></span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When diskless replication is enabled, it is possible to configure the delay</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the server waits <span class="keyword">in</span> order to spawn the child that transfers the RDB via socket</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to the replicas.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This is important since once the transfer starts, it is not possible to serve</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> new replicas arriving, that will be queued <span class="keyword">for</span> the next RDB transfer, so the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server waits a delay <span class="keyword">in</span> order to <span class="built_in">let</span> more replicas arrive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The delay is specified in seconds, and by default is 5 seconds. To disable</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it entirely just <span class="built_in">set</span> it to 0 seconds and the transfer will start ASAP.</span></span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARNING: RDB diskless load is experimental. Since <span class="keyword">in</span> this setup the replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> does not immediately store an RDB on disk, it may cause data loss during</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> failovers. RDB diskless load + Redis modules not handling I/O reads may also</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cause Redis to abort <span class="keyword">in</span> <span class="keyword">case</span> of I/O errors during the initial synchronization</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> stage with the master. Use only <span class="keyword">if</span> your <span class="keyword">do</span> what you are doing.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Replica can load the RDB it reads from the replication link directly from the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> socket, or store the RDB to a file and <span class="built_in">read</span> that file after it was completely</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> recived from the master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># In many cases the disk is slower than the network, and storing and loading</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the RDB file may increase replication time (and even increase the master<span class="string">&#x27;s</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Copy on Write memory and salve buffers).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However, parsing the RDB file directly from the socket may mean that we have</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to flush the contents of the current database before the full rdb was</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> received. For this reason we have the following options:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># &quot;disabled&quot;    - Don&#x27;t use diskless load (store the rdb file to the disk first)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;on-empty-db&quot;</span> - Use diskless load only when it is completely safe.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;swapdb&quot;</span>      - Keep a copy of the current db contents <span class="keyword">in</span> RAM <span class="keyword">while</span> parsing</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 the data directly from the socket. note that this requires</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 sufficient memory, <span class="keyword">if</span> you don<span class="string">&#x27;t have it, you risk an OOM kill.</span></span></span><br><span class="line">repl-diskless-load disabled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Replicas send PINGs to server <span class="keyword">in</span> a predefined interval. It<span class="string">&#x27;s possible to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> change this interval with the repl_ping_replica_period option. The default</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> value is 10 seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># repl-ping-replica-period 10</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following option sets the replication timeout <span class="keyword">for</span>:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) Bulk transfer I/O during SYNC, from the point of view of replica.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Master timeout from the point of view of replicas (data, pings).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># It is important to make sure that this value is greater than the value</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> specified <span class="keyword">for</span> repl-ping-replica-period otherwise a timeout will be detected</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> every time there is low traffic between the master and the replica.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># repl-timeout 60</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Disable TCP_NODELAY on the replica socket after SYNC?</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you select &quot;yes&quot; Redis will use a smaller number of TCP packets and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> less bandwidth to send data to replicas. But this can add a delay <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the data to appear on the replica side, up to 40 milliseconds with</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Linux kernels using a default configuration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you select &quot;no&quot; the delay for data to appear on the replica side will</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be reduced but more bandwidth will be used <span class="keyword">for</span> replication.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default we optimize for low latency, but in very high traffic conditions</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or when the master and replicas are many hops away, turning this to <span class="string">&quot;yes&quot;</span> may</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be a good idea.</span></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the replication backlog size. The backlog is a buffer that accumulates</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica data when replicas are disconnected <span class="keyword">for</span> some time, so that when a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica wants to reconnect again, often a full resync is not needed, but a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> partial resync is enough, just passing the portion of data the replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> missed <span class="keyword">while</span> disconnected.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The bigger the replication backlog, the longer the time the replica can be</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disconnected and later be able to perform a partial resynchronization.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The backlog is only allocated once there is at least a replica connected.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># repl-backlog-size 1mb</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> After a master has no longer connected replicas <span class="keyword">for</span> some time, the backlog</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will be freed. The following option configures the amount of seconds that</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> need to elapse, starting from the time the last replica disconnected, <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the backlog buffer to be freed.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note that replicas never free the backlog for timeout, since they may be</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> promoted to masters later, and should be able to correctly <span class="string">&quot;partially</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> resynchronize<span class="string">&quot; with the replicas: hence they should always accumulate backlog.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># A value of 0 means to never release the backlog.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># repl-backlog-ttl 3600</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The replica priority is an <span class="built_in">integer</span> number published by Redis <span class="keyword">in</span> the INFO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> output. It is used by Redis Sentinel <span class="keyword">in</span> order to select a replica to promote</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> into a master <span class="keyword">if</span> the master is no longer working correctly.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># A replica with a low priority number is considered better for promotion, so</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> instance <span class="keyword">if</span> there are three replicas with priority 10, 100, 25 Sentinel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will pick the one with priority 10, that is the lowest.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># However a special priority of 0 marks the replica as not able to perform the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> role of master, so a replica with priority of 0 will never be selected by</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis Sentinel <span class="keyword">for</span> promotion.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default the priority is 100.</span></span></span><br><span class="line">replica-priority 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible <span class="keyword">for</span> a master to stop accepting writes <span class="keyword">if</span> there are less than</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> N replicas connected, having a lag less or equal than M seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The N replicas need to be in &quot;online&quot; state.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The lag in seconds, that must be &lt;= the specified value, is calculated from</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the last ping received from the replica, that is usually sent every second.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This option does not GUARANTEE that N replicas will accept the write, but</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will <span class="built_in">limit</span> the window of exposure <span class="keyword">for</span> lost writes <span class="keyword">in</span> <span class="keyword">case</span> not enough replicas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are available, to the specified number of seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For example to require at least 3 replicas with a lag &lt;= 10 seconds use:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># min-replicas-to-write 3</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> min-replicas-max-lag 10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Setting one or the other to 0 disables the feature.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default min-replicas-to-write is set to 0 (feature disabled) and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> min-replicas-max-lag is <span class="built_in">set</span> to 10.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> A Redis master is able to list the address and port of the attached</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas <span class="keyword">in</span> different ways. For example the <span class="string">&quot;INFO replication&quot;</span> section</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> offers this information, <span class="built_in">which</span> is used, among other tools, by</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis Sentinel <span class="keyword">in</span> order to discover replica instances.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Another place <span class="built_in">where</span> this info is available is <span class="keyword">in</span> the output of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;ROLE&quot;</span> <span class="built_in">command</span> of a master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The listed IP and address normally reported by a replica is obtained</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the following way:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   IP: The address is auto detected by checking the peer address</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   of the socket used by the replica to connect with the master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   Port: The port is communicated by the replica during the replication</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   handshake, and is normally the port that the replica is using to</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   listen <span class="keyword">for</span> connections.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># However when port forwarding or Network Address Translation (NAT) is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used, the replica may be actually reachable via different IP and port</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pairs. The following two options can be used by a replica <span class="keyword">in</span> order to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> report to its master a specific <span class="built_in">set</span> of IP and port, so that both INFO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and ROLE will report those values.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># There is no need to use both the options if you need to override just</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the port or the IP address.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># replica-announce-ip 5.5.5.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica-announce-port 1234</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################## KEYS TRACKING #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis implements server assisted support <span class="keyword">for</span> client side caching of values.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is implemented using an invalidation table that remembers, using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 16 millions of slots, what clients may have certain subsets of keys. In turn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this is used <span class="keyword">in</span> order to send invalidation messages to clients. Please</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to understand more about the feature check this page:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   https://redis.io/topics/client-side-caching</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When tracking is enabled for a client, all the read only queries are assumed</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to be cached: this will force Redis to store information <span class="keyword">in</span> the invalidation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> table. When keys are modified, such information is flushed away, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> invalidation messages are sent to the clients. However <span class="keyword">if</span> the workload is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> heavily dominated by reads, Redis could use more and more memory <span class="keyword">in</span> order</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to track the keys fetched by many clients.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For this reason it is possible to configure a maximum fill value for the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> invalidation table. By default it is <span class="built_in">set</span> to 1M of keys, and once this <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is reached, Redis will start to evict keys <span class="keyword">in</span> the invalidation table</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> even <span class="keyword">if</span> they were not modified, just to reclaim memory: this will <span class="keyword">in</span> turn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> force the clients to invalidate the cached values. Basically the table</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maximum size is a trade off between the memory you want to spend server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> side to track information about who cached what, and the ability of clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to retain cached objects <span class="keyword">in</span> memory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you set the value to 0, it means there are no limits, and Redis will</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> retain as many keys as needed <span class="keyword">in</span> the invalidation table.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In the <span class="string">&quot;stats&quot;</span> INFO section, you can find information about the number of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> keys <span class="keyword">in</span> the invalidation table at every given moment.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note: when key tracking is used in broadcasting mode, no memory is used</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the server side so this setting is useless.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># tracking-table-max-keys 1000000</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# SECURITY ###################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Warning: since Redis is pretty fast an outside user can try up to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1 million passwords per second against a modern box. This means that you</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> should use very strong passwords, otherwise they will be very easy to <span class="built_in">break</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that because the password is really a shared secret between the client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and the server, and should not be memorized by any human, the password</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> can be easily a long string from /dev/urandom or whatever, so by using a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> long and unguessable password no brute force attack will be possible.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis ACL users are defined <span class="keyword">in</span> the following format:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   user &lt;username&gt; ... acl rules ...</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For example:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   user worker +@list +@connection ~jobs:* on &gt;ffa9203c493aa99</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The special username &quot;default&quot; is used for new connections. If this user</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> has the <span class="string">&quot;nopass&quot;</span> rule, <span class="keyword">then</span> new connections will be immediately authenticated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as the <span class="string">&quot;default&quot;</span> user without the need of any password provided via the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AUTH <span class="built_in">command</span>. Otherwise <span class="keyword">if</span> the <span class="string">&quot;default&quot;</span> user is not flagged with <span class="string">&quot;nopass&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the connections will start <span class="keyword">in</span> not authenticated state, and will require</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AUTH (or the HELLO <span class="built_in">command</span> AUTH option) <span class="keyword">in</span> order to be authenticated and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> start to work.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The ACL rules that describe what an user can do are the following:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  on           Enable the user: it is possible to authenticate as this user.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  off          Disable the user: it<span class="string">&#x27;s no longer possible to authenticate</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">               with this user, however the already authenticated connections</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               will still work.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  +&lt;<span class="built_in">command</span>&gt;   Allow the execution of that <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  -&lt;<span class="built_in">command</span>&gt;   Disallow the execution of that <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  +@&lt;category&gt; Allow the execution of all the commands <span class="keyword">in</span> such category</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               with valid categories are like @admin, @<span class="built_in">set</span>, @sortedset, ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               and so forth, see the full list <span class="keyword">in</span> the server.c file <span class="built_in">where</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">               the Redis <span class="built_in">command</span> table is described and defined.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               The special category @all means all the commands, but currently</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               present <span class="keyword">in</span> the server, and that will be loaded <span class="keyword">in</span> the future</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               via modules.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  +&lt;<span class="built_in">command</span>&gt;|subcommand    Allow a specific subcommand of an otherwise</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                           disabled <span class="built_in">command</span>. Note that this form is not</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                           allowed as negative like -DEBUG|SEGFAULT, but</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                           only additive starting with <span class="string">&quot;+&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  allcommands  Alias <span class="keyword">for</span> +@all. Note that it implies the ability to execute</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               all the future commands loaded via the modules system.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  nocommands   Alias <span class="keyword">for</span> -@all.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  ~&lt;pattern&gt;   Add a pattern of keys that can be mentioned as part of</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               commands. For instance ~* allows all the keys. The pattern</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               is a glob-style pattern like the one of KEYS.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               It is possible to specify multiple patterns.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  allkeys      Alias <span class="keyword">for</span> ~*</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  resetkeys    Flush the list of allowed keys patterns.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  &gt;&lt;password&gt;  Add this passowrd to the list of valid password <span class="keyword">for</span> the user.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               For example &gt;mypass will add <span class="string">&quot;mypass&quot;</span> to the list.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               This directive clears the <span class="string">&quot;nopass&quot;</span> flag (see later).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  &lt;&lt;<span class="string">password&gt;  Remove this password</span> from the list of valid passwords.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  nopass       All the <span class="built_in">set</span> passwords of the user are removed, and the user</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               is flagged as requiring no password: it means that every</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               password will work against this user. If this directive is</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               used <span class="keyword">for</span> the default user, every new connection will be</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               immediately authenticated with the default user without</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               any explicit AUTH <span class="built_in">command</span> required. Note that the <span class="string">&quot;resetpass&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">               directive will clear this condition.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  resetpass    Flush the list of allowed passwords. Moreover removes the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               <span class="string">&quot;nopass&quot;</span> status. After <span class="string">&quot;resetpass&quot;</span> the user has no associated</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               passwords and there is no way to authenticate without adding</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               some password (or setting it as <span class="string">&quot;nopass&quot;</span> later).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  reset        Performs the following actions: resetpass, resetkeys, off,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               -@all. The user returns to the same state it has immediately</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               after its creation.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># ACL rules can be specified in any order: for instance you can start with</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> passwords, <span class="keyword">then</span> flags, or key patterns. However note that the additive</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and subtractive rules will CHANGE MEANING depending on the ordering.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For instance see the following example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   user alice on +@all -DEBUG ~* &gt;somepassword</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This will allow &quot;alice&quot; to use all the commands with the exception of the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEBUG <span class="built_in">command</span>, since +@all added all the commands to the <span class="built_in">set</span> of the commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> alice can use, and later DEBUG was removed. However <span class="keyword">if</span> we invert the order</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of two ACL rules the result will be different:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   user alice on -DEBUG +@all ~* &gt;somepassword</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Now DEBUG was removed when alice had yet no commands in the set of allowed</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commands, later all the commands are added, so the user will be able to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> execute everything.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Basically ACL rules are processed left-to-right.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For more information about ACL configuration please refer to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the Redis web site at https://redis.io/topics/acl</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACL LOG</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The ACL Log tracks failed commands and authentication events associated</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with ACLs. The ACL Log is useful to troubleshoot failed commands blocked</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> by ACLs. The ACL Log is stored <span class="keyword">in</span> memory. You can reclaim memory with</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> ACL LOG RESET. Define the maximum entry length of the ACL Log below.</span></span><br><span class="line">acllog-max-len 128</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Using an external ACL file</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Instead of configuring users here in this file, it is possible to use</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a stand-alone file just listing users. The two methods cannot be mixed:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> you configure users here and at the same time you activate the exteranl</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACL file, the server will refuse to start.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The format of the external ACL user file is exactly the same as the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> format that is used inside redis.conf to describe users.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># aclfile /etc/redis/users.acl</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMPORTANT NOTE: starting with Redis 6 <span class="string">&quot;requirepass&quot;</span> is just a compatiblity</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> layer on top of the new ACL system. The option effect will be just setting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the password <span class="keyword">for</span> the default user. Clients will still authenticate using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AUTH &lt;password&gt; as usually, or more explicitly with AUTH default &lt;password&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> they follow the new protocol: both will work.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># requirepass foobared</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Command renaming (DEPRECATED).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># ------------------------------------------------------------------------</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARNING: avoid using this option <span class="keyword">if</span> possible. Instead use ACLs to remove</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commands from the default user, and put them only <span class="keyword">in</span> some admin user you</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> create <span class="keyword">for</span> administrative purposes.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># It is possible to change the name of dangerous commands in a shared</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> environment. For instance the CONFIG <span class="built_in">command</span> may be renamed into something</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hard to guess so that it will still be available <span class="keyword">for</span> internal-use tools</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but not available <span class="keyword">for</span> general clients.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Example:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># It is also possible to completely kill a command by renaming it into</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> an empty string:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># rename-command CONFIG &quot;&quot;</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Please note that changing the name of commands that are logged into the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AOF file or transmitted to replicas may cause problems.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################## CLIENTS ####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the max number of connected clients at the same time. By default</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this <span class="built_in">limit</span> is <span class="built_in">set</span> to 10000 clients, however <span class="keyword">if</span> the Redis server is not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> able to configure the process file <span class="built_in">limit</span> to allow <span class="keyword">for</span> the specified <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the max number of allowed clients is <span class="built_in">set</span> to the current file <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> minus 32 (as Redis reserves a few file descriptors <span class="keyword">for</span> internal uses).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Once the limit is reached Redis will close all the new connections sending</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> an error <span class="string">&#x27;max number of clients reached&#x27;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># IMPORTANT: When Redis Cluster is used, the max number of connections is also</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> shared with the cluster bus: every node <span class="keyword">in</span> the cluster will use two</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> connections, one incoming and another outgoing. It is important to size the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">limit</span> accordingly <span class="keyword">in</span> <span class="keyword">case</span> of very large clusters.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># maxclients 10000</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################# MEMORY MANAGEMENT ################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set a memory usage <span class="built_in">limit</span> to the specified amount of bytes.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When the memory <span class="built_in">limit</span> is reached Redis will try to remove keys</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> according to the eviction policy selected (see maxmemory-policy).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If Redis can&#x27;t remove keys according to the policy, or if the policy is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> to <span class="string">&#x27;noeviction&#x27;</span>, Redis will start to reply with errors to commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that would use more memory, like SET, LPUSH, and so on, and will <span class="built_in">continue</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to reply to read-only commands like GET.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This option is usually useful when using Redis as an LRU or LFU cache, or to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> a hard memory <span class="built_in">limit</span> <span class="keyword">for</span> an instance (using the <span class="string">&#x27;noeviction&#x27;</span> policy).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># WARNING: If you have replicas attached to an instance with maxmemory on,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the size of the output buffers needed to feed the replicas are subtracted</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> from the used memory count, so that network problems / resyncs will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not trigger a loop <span class="built_in">where</span> keys are evicted, and <span class="keyword">in</span> turn the output</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> buffer of replicas is full with DELs of keys evicted triggering the deletion</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of more keys, and so forth until the database is completely emptied.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># In short... if you have replicas attached it is suggested that you set a lower</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">limit</span> <span class="keyword">for</span> maxmemory so that there is some free RAM on the system <span class="keyword">for</span> replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> output buffers (but this is not needed <span class="keyword">if</span> the policy is <span class="string">&#x27;noeviction&#x27;</span>).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># maxmemory &lt;bytes&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is reached. You can select one from the following behaviors:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># volatile-lru -&gt; Evict using approximated LRU, only keys with an expire set.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-lru -&gt; Evict any key using approximated LRU.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-lfu -&gt; Evict using approximated LFU, only keys with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-lfu -&gt; Evict any key using approximated LFU.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-random -&gt; Remove a random key having an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-random -&gt; Remove a random key, any key.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> noeviction -&gt; Don<span class="string">&#x27;t evict anything, just return an error on write operations.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># LRU means Least Recently Used</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LFU means Least Frequently Used</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Both LRU, LFU and volatile-ttl are implemented using approximated</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> randomized algorithms.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note: with any of the above policies, Redis will return an error on write</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       operations, when there are no suitable keys <span class="keyword">for</span> eviction.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#       At the date of writing these commands are: set setnx setex append</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       getset mset msetnx <span class="built_in">exec</span> sort</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The default is:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># maxmemory-policy noeviction</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> algorithms (<span class="keyword">in</span> order to save memory), so you can tune it <span class="keyword">for</span> speed or</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> accuracy. For default Redis will check five keys and pick the one that was</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used less recently, you can change the sample size using the following</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configuration directive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The default of 5 produces good enough results. 10 Approximates very closely</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="literal">true</span> LRU but costs more CPU. 3 is faster but not very accurate.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># maxmemory-samples 5</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Starting from Redis 5, by default a replica will ignore its maxmemory setting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (unless it is promoted to master after a failover or manually). It means</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that the eviction of keys will be just handled by the master, sending the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEL commands to the replica as keys evict <span class="keyword">in</span> the master side.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This behavior ensures that masters and replicas stay consistent, and is usually</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> what you want, however <span class="keyword">if</span> your replica is writable, or you want the replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to have a different memory setting, and you are sure all the writes performed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to the replica are idempotent, <span class="keyword">then</span> you may change this default (but be sure</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to understand what you are doing).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note that since the replica by default does not evict, it may end using more</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> memory than the one <span class="built_in">set</span> via maxmemory (there are certain buffers that may</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be larger on the replica, or data structures may sometimes take more memory</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and so forth). So make sure you monitor your replicas and make sure they</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> have enough memory to never hit a real out-of-memory condition before the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master hits the configured maxmemory setting.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># replica-ignore-maxmemory yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis reclaims expired keys <span class="keyword">in</span> two ways: upon access when those keys are</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> found to be expired, and also <span class="keyword">in</span> background, <span class="keyword">in</span> what is called the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;active expire key&quot;</span>. The key space is slowly and interactively scanned</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> looking <span class="keyword">for</span> expired keys to reclaim, so that it is possible to free memory</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of keys that are expired and will never be accessed again <span class="keyword">in</span> a short time.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The default effort of the expire cycle will try to avoid having more than</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ten percent of expired keys still <span class="keyword">in</span> memory, and will try to avoid consuming</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> more than 25% of total memory and to add latency to the system. However</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it is possible to increase the expire <span class="string">&quot;effort&quot;</span> that is normally <span class="built_in">set</span> to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;1&quot;</span>, to a greater value, up to the value <span class="string">&quot;10&quot;</span>. At its maximum value the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> system will use more CPU, longer cycles (and technically may introduce</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> more latency), and will tollerate less already expired keys still present</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the system. It<span class="string">&#x27;s a tradeoff betweeen memory, CPU and latecy.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># active-expire-effort 1</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################ LAZY FREEING ####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis has two primitives to delete keys. One is called DEL and is a blocking</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> deletion of the object. It means that the server stops processing new commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to reclaim all the memory associated with an object <span class="keyword">in</span> a synchronous</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> way. If the key deleted is associated with a small object, the time needed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to execute the DEL <span class="built_in">command</span> is very small and comparable to most other</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> O(1) or O(log_N) commands <span class="keyword">in</span> Redis. However <span class="keyword">if</span> the key is associated with an</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> aggregated value containing millions of elements, the server can block <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a long time (even seconds) <span class="keyword">in</span> order to complete the operation.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For the above reasons Redis also offers non blocking deletion primitives</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> FLUSHDB commands, <span class="keyword">in</span> order to reclaim memory <span class="keyword">in</span> background. Those commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are executed <span class="keyword">in</span> constant time. Another thread will incrementally free the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> object <span class="keyword">in</span> the background as fast as possible.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It<span class="string">&#x27;s up to the design of the application to understand when it is a good</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> idea to use one or the other. However the Redis server sometimes has to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete keys or flush the whole database as a side effect of other operations.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specifically Redis deletes objects independently of a user call <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> following scenarios:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) On eviction, because of the maxmemory and maxmemory policy configurations,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="keyword">in</span> order to make room <span class="keyword">for</span> new data, without going over the specified</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    memory <span class="built_in">limit</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Because of expire: when a key with an associated time to live (see the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    EXPIRE <span class="built_in">command</span>) must be deleted from memory.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3) Because of a side effect of a <span class="built_in">command</span> that stores data on a key that may</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    already exist. For example the RENAME <span class="built_in">command</span> may delete the old key</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    content when it is replaced with another one. Similarly SUNIONSTORE</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    or SORT with STORE option may delete existing keys. The SET <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    itself removes any old content of the specified key <span class="keyword">in</span> order to replace</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    it with the specified string.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4) During replication, when a replica performs a full resynchronization with</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    its master, the content of the whole database is removed <span class="keyword">in</span> order to</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    load the RDB file just transferred.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># In all the above cases the default is to delete objects in a blocking way,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> like <span class="keyword">if</span> DEL was called. However you can configure each <span class="keyword">case</span> specifically</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to instead release memory <span class="keyword">in</span> a non-blocking way like <span class="keyword">if</span> UNLINK</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> was called, using the following configuration directives.</span></span><br><span class="line"></span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is also possible, <span class="keyword">for</span> the <span class="keyword">case</span> when to replace the user code DEL calls</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with UNLINK calls is not easy, to modify the default behavior of the DEL</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> to act exactly like UNLINK, using the following configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directive:</span></span><br><span class="line"></span><br><span class="line">lazyfree-lazy-user-del no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### THREADED I/O #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis is mostly single threaded, however there are certain threaded</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> operations such as UNLINK, slow I/O accesses and other things that are</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performed on side threads.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Now it is also possible to handle Redis clients socket reads and writes</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> different I/O threads. Since especially writing is so slow, normally</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis users use pipelining <span class="keyword">in</span> order to speedup the Redis performances per</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> core, and spawn multiple instances <span class="keyword">in</span> order to scale more. Using I/O</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threads it is possible to easily speedup two <span class="built_in">times</span> Redis without resorting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to pipelining nor sharding of the instance.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default threading is disabled, we suggest enabling it only in machines</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that have at least 4 or more cores, leaving at least one spare core.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Using more than 8 threads is unlikely to <span class="built_in">help</span> much. We also recommend using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threaded I/O only <span class="keyword">if</span> you actually have performance problems, with Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instances being able to use a quite big percentage of CPU time, otherwise</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> there is no point <span class="keyword">in</span> using this feature.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># So for instance if you have a four cores boxes, try to use 2 or 3 I/O</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threads, <span class="keyword">if</span> you have a 8 cores, try to use 6 threads. In order to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span> I/O threads use the following configuration directive:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># io-threads 4</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Setting io-threads to 1 will just use the main thread as usually.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When I/O threads are enabled, we only use threads <span class="keyword">for</span> writes, that is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to thread the write(2) syscall and transfer the client buffers to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> socket. However it is also possible to <span class="built_in">enable</span> threading of reads and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> protocol parsing using the following configuration directive, by setting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it to yes:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># io-threads-do-reads no</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Usually threading reads doesn&#x27;t help much.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># NOTE 1: This configuration directive cannot be changed at runtime via</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONFIG SET. Aso this feature currently does not work when SSL is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> enabled.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># NOTE 2: If you want to test the Redis speedup using redis-benchmark, make</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sure you also run the benchmark itself <span class="keyword">in</span> threaded mode, using the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --threads option to match the number of Redis theads, otherwise you<span class="string">&#x27;ll not</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be able to notice the improvements.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########################### KERNEL OOM CONTROL ##############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> On Linux, it is possible to hint the kernel OOM killer on what processes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> should be killed first when out of memory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Enabling this feature makes Redis actively control the oom_score_adj value</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> all its processes, depending on their role. The default scores will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> attempt to have background child processes killed before all others, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas killed before masters.</span></span><br><span class="line"></span><br><span class="line">oom-score-adj no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When oom-score-adj is used, this directive controls the specific values used</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> master, replica and background child processes. Values range -1000 to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1000 (higher means more likely to be killed).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Unprivileged processes (not root, and without CAP_SYS_RESOURCE capabilities)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> can freely increase their value, but not decrease it below its initial</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> settings.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Values are used relative to the initial value of oom_score_adj when the server</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> starts. Because typically the initial value is 0, they will often match the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> absolute values.</span></span><br><span class="line"></span><br><span class="line">oom-score-adj-values 0 200 800</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################# APPEND ONLY MODE ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis asynchronously dumps the dataset on disk. This mode is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> good enough <span class="keyword">in</span> many applications, but an issue with the Redis process or</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a power outage may result into a few minutes of writes lost (depending on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the configured save points).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The Append Only File is an alternative persistence mode that provides</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> much better durability. For instance using the default data fsync policy</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (see later <span class="keyword">in</span> the config file) Redis can lose just one second of writes <span class="keyword">in</span> a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dramatic event like a server power outage, or a single write <span class="keyword">if</span> something</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wrong with the Redis process itself happens, but the operating system is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> still running correctly.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># AOF and RDB persistence can be enabled at the same time without problems.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the AOF is enabled on startup Redis will load the AOF, that is the file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with the better durability guarantees.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Please check http://redis.io/topics/persistence for more information.</span></span></span><br><span class="line"></span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The name of the append only file (default: <span class="string">&quot;appendonly.aof&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The fsync() call tells the Operating System to actually write data on disk</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instead of waiting <span class="keyword">for</span> more data <span class="keyword">in</span> the output buffer. Some OS will really flush</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data on disk, some other OS will just try to <span class="keyword">do</span> it ASAP.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Redis supports three different modes:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># no: don&#x27;t fsync, just let the OS flush the data when it wants. Faster.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> always: fsync after every write to the append only <span class="built_in">log</span>. Slow, Safest.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> everysec: fsync only one time every second. Compromise.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The default is &quot;everysec&quot;, as that&#x27;s usually the right compromise between</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> speed and data safety. It<span class="string">&#x27;s up to you to understand if you can relax this to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;no&quot;</span> that will <span class="built_in">let</span> the operating system flush the output buffer when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it wants, <span class="keyword">for</span> better performances (but <span class="keyword">if</span> you can live with the idea of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> some data loss consider the default persistence mode that<span class="string">&#x27;s snapshotting),</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or on the contrary, use <span class="string">&quot;always&quot;</span> that<span class="string">&#x27;s very slow but a bit safer than</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> everysec.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># More details please check the following article:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http://antirez.com/post/redis-persistence-demystified.html</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If unsure, use &quot;everysec&quot;.</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> appendfsync always</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="meta">#</span><span class="bash"> appendfsync no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When the AOF fsync policy is <span class="built_in">set</span> to always or everysec, and a background</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> saving process (a background save or AOF <span class="built_in">log</span> background rewriting) is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performing a lot of I/O against the disk, <span class="keyword">in</span> some Linux configurations</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis may block too long on the fsync() call. Note that there is no fix <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this currently, as even performing fsync <span class="keyword">in</span> a different thread will block</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> our synchronous write(2) call.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># In order to mitigate this problem it&#x27;s possible to use the following option</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that will prevent fsync() from being called <span class="keyword">in</span> the main process <span class="keyword">while</span> a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BGSAVE or BGREWRITEAOF is <span class="keyword">in</span> progress.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This means that while another child is saving, the durability of Redis is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the same as <span class="string">&quot;appendfsync none&quot;</span>. In practical terms, this means that it is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> possible to lose up to 30 seconds of <span class="built_in">log</span> <span class="keyword">in</span> the worst scenario (with the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default Linux settings).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you have latency problems turn this to &quot;yes&quot;. Otherwise leave it as</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;no&quot;</span> that is the safest pick from the point of view of durability.</span></span><br><span class="line"></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Automatic rewrite of the append only file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis is able to automatically rewrite the <span class="built_in">log</span> file implicitly calling</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BGREWRITEAOF when the AOF <span class="built_in">log</span> size grows by the specified percentage.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This is how it works: Redis remembers the size of the AOF file after the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> latest rewrite (<span class="keyword">if</span> no rewrite has happened since the restart, the size of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the AOF at startup is used).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This base size is compared to the current size. If the current size is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bigger than the specified percentage, the rewrite is triggered. Also</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you need to specify a minimal size <span class="keyword">for</span> the AOF file to be rewritten, this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is useful to avoid rewriting the AOF file even <span class="keyword">if</span> the percentage increase</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is reached but it is still pretty small.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Specify a percentage of zero in order to disable the automatic AOF</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rewrite feature.</span></span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> An AOF file may be found to be truncated at the end during the Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> startup process, when the AOF data gets loaded back into memory.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This may happen when the system <span class="built_in">where</span> Redis is running</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> crashes, especially when an ext4 filesystem is mounted without the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data=ordered option (however this can<span class="string">&#x27;t happen when Redis itself</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> crashes or aborts but the operating system still works correctly).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Redis can either exit with an error when this happens, or load as much</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data as possible (the default now) and start <span class="keyword">if</span> the AOF file is found</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to be truncated at the end. The following option controls this behavior.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the Redis server starts emitting a <span class="built_in">log</span> to inform the user of the event.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Otherwise <span class="keyword">if</span> the option is <span class="built_in">set</span> to no, the server aborts with an error</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and refuses to start. When the option is <span class="built_in">set</span> to no, the user requires</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to fix the AOF file using the <span class="string">&quot;redis-check-aof&quot;</span> utility before to restart</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the server.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note that if the AOF file will be found to be corrupted in the middle</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the server will still <span class="built_in">exit</span> with an error. This option only applies when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis will try to <span class="built_in">read</span> more data from the AOF file but not enough bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will be found.</span></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When rewriting the AOF file, Redis is able to use an RDB preamble <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AOF file <span class="keyword">for</span> faster rewrites and recoveries. When this option is turned</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on the rewritten AOF file is composed of two different stanzas:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   [RDB file][AOF tail]</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When loading Redis recognizes that the AOF file starts with the &quot;REDIS&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> string and loads the prefixed RDB file, and continues loading the AOF</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tail.</span></span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### LUA SCRIPTING  ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Max execution time of a Lua script <span class="keyword">in</span> milliseconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If the maximum execution time is reached Redis will log that a script is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> still <span class="keyword">in</span> execution after the maximum allowed time and will start to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> reply to queries with an error.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When a long running script exceeds the maximum execution time only the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used to stop a script that did not yet called write commands. The second</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is the only way to shut down the server <span class="keyword">in</span> the <span class="keyword">case</span> a write <span class="built_in">command</span> was</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> already issued by the script but the user doesn<span class="string">&#x27;t want to wait for the natural</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> termination of the script.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Set it to 0 or a negative value for unlimited execution without warnings.</span></span></span><br><span class="line">lua-time-limit 5000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### REDIS CLUSTER  ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Normal Redis instances can<span class="string">&#x27;t be part of a Redis Cluster; only nodes that are</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> started as cluster nodes can. In order to start a Redis instance as a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster node <span class="built_in">enable</span> the cluster support uncommenting the following:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-enabled yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Every cluster node has a cluster configuration file. This file is not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> intended to be edited by hand. It is created and updated by Redis nodes.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Every Redis Cluster node requires a different cluster configuration file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make sure that instances running <span class="keyword">in</span> the same system <span class="keyword">do</span> not have</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> overlapping cluster configuration file names.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-config-file nodes-6379.conf</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Cluster node timeout is the amount of milliseconds a node must be unreachable</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> it to be considered <span class="keyword">in</span> failure state.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Most other internal time limits are multiple of the node timeout.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-node-timeout 15000</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> A replica of a failing master will avoid to start a failover <span class="keyword">if</span> its data</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> looks too old.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># There is no simple way for a replica to actually have an exact measure of</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> its <span class="string">&quot;data age&quot;</span>, so the following two checks are performed:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1) If there are multiple replicas able to failover, they exchange messages</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="keyword">in</span> order to try to give an advantage to the replica with the best</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    replication offset (more data from the master processed).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    Replicas will try to get their rank by offset, and apply to the start</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    of the failover a delay proportional to their rank.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 2) Every single replica computes the time of the last interaction with</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    its master. This can be the last ping or <span class="built_in">command</span> received (<span class="keyword">if</span> the master</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    is still <span class="keyword">in</span> the <span class="string">&quot;connected&quot;</span> state), or the time that elapsed since the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    disconnection with the master (<span class="keyword">if</span> the replication link is currently down).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    If the last interaction is too old, the replica will not try to failover</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    at all.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The point &quot;2&quot; can be tuned by user. Specifically a replica will not perform</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the failover <span class="keyword">if</span>, since the last interaction with the master, the time</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> elapsed is greater than:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   (node-timeout * replica-validity-factor) + repl-ping-replica-period</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># So for example if node-timeout is 30 seconds, and the replica-validity-factor</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is 10, and assuming a default repl-ping-replica-period of 10 seconds, the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica will not try to failover <span class="keyword">if</span> it was not able to talk with the master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> longer than 310 seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># A large replica-validity-factor may allow replicas with too old data to failover</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a master, <span class="keyword">while</span> a too small value may prevent the cluster from being able to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> elect a replica at all.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For maximum availability, it is possible to set the replica-validity-factor</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to a value of 0, <span class="built_in">which</span> means, that replicas will always try to failover the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master regardless of the last time they interacted with the master.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (However they<span class="string">&#x27;ll always try to apply a delay proportional to their</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> offset rank).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Zero is the only value able to guarantee that when all the partitions heal</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the cluster will always be able to <span class="built_in">continue</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-replica-validity-factor 10</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Cluster replicas are able to migrate to orphaned masters, that are masters</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that are left without working replicas. This improves the cluster ability</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to resist to failures as otherwise an orphaned master can<span class="string">&#x27;t be failed over</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> <span class="keyword">case</span> of failure <span class="keyword">if</span> it has no working replicas.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Replicas migrate to orphaned masters only if there are still at least a</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> given number of other working replicas <span class="keyword">for</span> their old master. This number</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is the <span class="string">&quot;migration barrier&quot;</span>. A migration barrier of 1 means that a replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will migrate only <span class="keyword">if</span> there is at least 1 other working replica <span class="keyword">for</span> its master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and so forth. It usually reflects the number of replicas you want <span class="keyword">for</span> every</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master <span class="keyword">in</span> your cluster.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Default is 1 (replicas migrate only if their masters remain with at least</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> one replica). To <span class="built_in">disable</span> migration just <span class="built_in">set</span> it to a very large value.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A value of 0 can be <span class="built_in">set</span> but is useful only <span class="keyword">for</span> debugging and dangerous</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> production.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-migration-barrier 1</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis Cluster nodes stop accepting queries <span class="keyword">if</span> they detect there</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is at least an <span class="built_in">hash</span> slot uncovered (no available node is serving it).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This way <span class="keyword">if</span> the cluster is partially down (<span class="keyword">for</span> example a range of <span class="built_in">hash</span> slots</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are no longer covered) all the cluster becomes, eventually, unavailable.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It automatically returns available as soon as all the slots are covered again.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># However sometimes you want the subset of the cluster which is working,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to <span class="built_in">continue</span> to accept queries <span class="keyword">for</span> the part of the key space that is still</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> covered. In order to <span class="keyword">do</span> so, just <span class="built_in">set</span> the cluster-require-full-coverage</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> option to no.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-require-full-coverage yes</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This option, when <span class="built_in">set</span> to yes, prevents replicas from trying to failover its</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master during master failures. However the master can still perform a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> manual failover, <span class="keyword">if</span> forced to <span class="keyword">do</span> so.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This is useful in different scenarios, especially in the case of multiple</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data center operations, <span class="built_in">where</span> we want one side to never be promoted <span class="keyword">if</span> not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the <span class="keyword">case</span> of a total DC failure.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-replica-no-failover no</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This option, when <span class="built_in">set</span> to yes, allows nodes to serve <span class="built_in">read</span> traffic <span class="keyword">while</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the cluster is <span class="keyword">in</span> a down state, as long as it believes it owns the slots.</span> </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># This is useful for two cases.  The first case is for when an application</span></span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> doesn<span class="string">&#x27;t require consistency of data during node failures or network partitions.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> One example of this is a cache, <span class="built_in">where</span> as long as the node has the data it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> should be able to serve it.</span> </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The second use case is for configurations that don&#x27;t meet the recommended</span></span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> three shards but want to <span class="built_in">enable</span> cluster mode and scale later. A</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> master outage <span class="keyword">in</span> a 1 or 2 shard configuration causes a <span class="built_in">read</span>/write outage to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> entire cluster without this option <span class="built_in">set</span>, with it <span class="built_in">set</span> there is only a write outage.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Without a quorum of masters, slot ownership will not change automatically.</span> </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-allow-reads-when-down no</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> In order to setup your cluster make sure to <span class="built_in">read</span> the documentation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> available at http://redis.io web site.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">######################### CLUSTER DOCKER/NAT support  ########################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> In certain deployments, Redis Cluster nodes address discovery fails, because</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> addresses are NAT-ted or because ports are forwarded (the typical <span class="keyword">case</span> is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Docker and other containers).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># In order to make Redis Cluster working in such environments, a static</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configuration <span class="built_in">where</span> each node knows its public address is needed. The</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> following two options are used <span class="keyword">for</span> this scope, and are:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># * cluster-announce-ip</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * cluster-announce-port</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * cluster-announce-bus-port</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Each instruct the node about its address, client port, and cluster message</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bus port. The information is <span class="keyword">then</span> published <span class="keyword">in</span> the header of the bus packets</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> so that other nodes will be able to correctly map the address of the node</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> publishing the information.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If the above options are not used, the normal Redis Cluster auto-detection</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will be used instead.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Note that when remapped, the bus port may not be at the fixed offset of</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> clients port + 10000, so you can specify any port and bus-port depending</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on how they get remapped. If the bus-port is not <span class="built_in">set</span>, a fixed offset of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 10000 will be used as usually.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Example:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># cluster-announce-ip 10.1.1.5</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-announce-port 6379</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-announce-bus-port 6380</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# SLOW LOG ###################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Redis Slow Log is a system to <span class="built_in">log</span> queries that exceeded a specified</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> execution time. The execution time does not include the I/O operations</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> like talking with the client, sending the reply and so forth,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but just the time needed to actually execute the <span class="built_in">command</span> (this is the only</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> stage of <span class="built_in">command</span> execution <span class="built_in">where</span> the thread is blocked and can not serve</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> other requests <span class="keyword">in</span> the meantime).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># You can configure the slow log with two parameters: one tells Redis</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> what is the execution time, <span class="keyword">in</span> microseconds, to exceed <span class="keyword">in</span> order <span class="keyword">for</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> to get logged, and the other parameter is the length of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> slow <span class="built_in">log</span>. When a new <span class="built_in">command</span> is logged the oldest one is removed from the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> queue of logged commands.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following time is expressed <span class="keyword">in</span> microseconds, so 1000000 is equivalent</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to one second. Note that a negative number disables the slow <span class="built_in">log</span>, <span class="keyword">while</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a value of zero forces the logging of every <span class="built_in">command</span>.</span></span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> There is no <span class="built_in">limit</span> to this length. Just be aware that it will consume memory.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can reclaim memory used by the slow <span class="built_in">log</span> with SLOWLOG RESET.</span></span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### LATENCY MONITOR ##############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Redis latency monitoring subsystem samples different operations</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> at runtime <span class="keyword">in</span> order to collect data related to possible sources of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> latency of a Redis instance.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Via the LATENCY command this information is available to the user that can</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">print</span> graphs and obtain reports.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The system only logs operations that were performed in a time equal or</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> greater than the amount of milliseconds specified via the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> latency-monitor-threshold configuration directive. When its value is <span class="built_in">set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to zero, the latency monitor is turned off.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default latency monitoring is disabled since it is mostly not needed</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> you don<span class="string">&#x27;t have latency issues, and collecting data has a performance</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> impact, that <span class="keyword">while</span> very small, can be measured under big load. Latency</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> monitoring can easily be enabled at runtime using the <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;&quot;</span> <span class="keyword">if</span> needed.</span></span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################ EVENT NOTIFICATION ##############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis can notify Pub/Sub clients about events happening <span class="keyword">in</span> the key space.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This feature is documented at http://redis.io/topics/notifications</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># For instance if keyspace events notification is enabled, and a client</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performs a DEL operation on key <span class="string">&quot;foo&quot;</span> stored <span class="keyword">in</span> the Database 0, two</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> messages will be published via Pub/Sub:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># PUBLISH __keyspace@0__:foo del</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PUBLISH __keyevent@0__:del foo</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># It is possible to select the events that Redis will notify among a set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of classes. Every class is identified by a single character:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  $     String commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  l     List commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  s     Set commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  h     Hash commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  z     Sorted <span class="built_in">set</span> commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  x     Expired events (events generated every time a key expires)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  e     Evicted events (events generated when a key is evicted <span class="keyword">for</span> maxmemory)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  t     Stream commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  m     Key-miss events (Note: It is not included <span class="keyword">in</span> the <span class="string">&#x27;A&#x27;</span> class)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  A     Alias <span class="keyword">for</span> g<span class="variable">$lshzxet</span>, so that the <span class="string">&quot;AKE&quot;</span> string means all the events</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        (Except key-miss events <span class="built_in">which</span> are excluded from <span class="string">&#x27;A&#x27;</span> due to their</span></span><br><span class="line"><span class="meta">#</span><span class="bash">         unique nature).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  The &quot;notify-keyspace-events&quot; takes as argument a string that is composed</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  of zero or multiple characters. The empty string means that notifications</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  are disabled.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  Example: to enable list and generic events, from the point of view of the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">           event name, use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  notify-keyspace-events Elg</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  Example 2: to get the stream of the expired keys subscribing to channel</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">             name __keyevent@0__:expired use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  notify-keyspace-events Ex</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#  By default all notifications are disabled because most users don&#x27;t need</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  this feature and the feature has some overhead. Note that <span class="keyword">if</span> you don<span class="string">&#x27;t</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  specify at least one of K or E, no events will be delivered.</span></span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################## GOPHER SERVER #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis contains an implementation of the Gopher protocol, as specified <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the RFC 1436 (https://www.ietf.org/rfc/rfc1436.txt).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The Gopher protocol was very popular in the late &#x27;90s. It is an alternative</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to the web, and the implementation both server and client side is so simple</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that the Redis server has just 100 lines of code <span class="keyword">in</span> order to implement this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> support.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># What do you do with Gopher nowadays? Well Gopher never *really* died, and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lately there is a movement <span class="keyword">in</span> order <span class="keyword">for</span> the Gopher more hierarchical content</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> composed of just plain text documents to be resurrected. Some want a simpler</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> internet, others believe that the mainstream internet became too much</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> controlled, and it<span class="string">&#x27;s cool to create an alternative space for people that</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> want a bit of fresh air.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Anyway for the 10nth birthday of the Redis, we gave it the Gopher protocol</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as a gift.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># --- HOW IT WORKS? ---</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The Redis Gopher support uses the inline protocol of Redis, and specifically</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> two kind of inline requests that were anyway illegal: an empty request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or any request that starts with <span class="string">&quot;/&quot;</span> (there are no Redis commands starting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with such a slash). Normal RESP2/RESP3 requests are completely out of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> path of the Gopher protocol implementation and are served as usually as well.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you open a connection to Redis when Gopher is enabled and send it</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a string like <span class="string">&quot;/foo&quot;</span>, <span class="keyword">if</span> there is a key named <span class="string">&quot;/foo&quot;</span> it is served via the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Gopher protocol.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># In order to create a real Gopher &quot;hole&quot; (the name of a Gopher site in Gopher</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> talking), you likely need a script like the following:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   https://github.com/antirez/gopher2redis</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># --- SECURITY WARNING ---</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you plan to put Redis on the internet in a publicly accessible address</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to server Gopher pages MAKE SURE TO SET A PASSWORD to the instance.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Once a password is <span class="built_in">set</span>:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   1. The Gopher server (when enabled, not by default) will still serve</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">      content via Gopher.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   2. However other commands cannot be called before the client will</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      authenticate.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># So use the &#x27;requirepass&#x27; option to protect your instance.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># To enable Gopher support uncomment the following line and set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the option from no (the default) to yes.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># gopher-enabled no</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################## ADVANCED CONFIG ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Hashes are encoded using a memory efficient data structure when they have a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> small number of entries, and the biggest entry does not exceed a given</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threshold. These thresholds can be configured using the following directives.</span></span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Lists are also encoded <span class="keyword">in</span> a special way to save a lot of space.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The number of entries allowed per internal list node can be specified</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as a fixed maximum size or a maximum number of elements.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For a fixed maximum size, use -5 through -1, meaning:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -5: max size: 64 Kb  &lt;-- not recommended <span class="keyword">for</span> normal workloads</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -4: max size: 32 Kb  &lt;-- not recommended</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -3: max size: 16 Kb  &lt;-- probably not recommended</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -2: max size: 8 Kb   &lt;-- good</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -1: max size: 4 Kb   &lt;-- good</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Positive numbers mean store up to _exactly_ that number of elements</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> per list node.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but <span class="keyword">if</span> your use <span class="keyword">case</span> is unique, adjust the settings as necessary.</span></span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Lists may also be compressed.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Compress depth is the number of quicklist ziplist nodes from *each* side of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the list to *exclude* from compression.  The head and tail of the list</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are always uncompressed <span class="keyword">for</span> fast push/pop operations.  Settings are:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 0: <span class="built_in">disable</span> all list compression</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1: depth 1 means <span class="string">&quot;don&#x27;t start compressing until after 1 node into the list,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    going from either the head or tail<span class="string">&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    [head], [tail] will always be uncompressed; inner nodes will compress.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    2 here means: don<span class="string">&#x27;t compress head or head-&gt;next or tail-&gt;prev or tail,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    but compress all nodes between them.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> etc.</span></span><br><span class="line">list-compress-depth 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Sets have a special encoding <span class="keyword">in</span> just one <span class="keyword">case</span>: when a <span class="built_in">set</span> is composed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of just strings that happen to be integers <span class="keyword">in</span> radix 10 <span class="keyword">in</span> the range</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of 64 bit signed integers.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following configuration setting sets the <span class="built_in">limit</span> <span class="keyword">in</span> the size of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> <span class="keyword">in</span> order to use this special memory saving encoding.</span></span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Similarly to hashes and lists, sorted sets are also specially encoded <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> order to save a lot of space. This encoding is only used when the length and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> elements of a sorted <span class="built_in">set</span> are below the following limits:</span></span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> HyperLogLog sparse representation bytes <span class="built_in">limit</span>. The <span class="built_in">limit</span> includes the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 16 bytes header. When an HyperLogLog using the sparse representation crosses</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this <span class="built_in">limit</span>, it is converted into the dense representation.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># A value greater than 16000 is totally useless, since at that point the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dense representation is more memory efficient.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The suggested value is ~ 3000 in order to have the benefits of</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the space efficient encoding without slowing down too much PFADD,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">which</span> is O(N) with the sparse encoding. The value can be raised to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ~ 10000 when CPU is not a concern, but space is, and the data <span class="built_in">set</span> is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> composed of many HyperLogLogs with cardinality <span class="keyword">in</span> the 0 - 15000 range.</span></span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Streams macro node max size / items. The stream data structure is a radix</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tree of big nodes that encode multiple items inside. Using this configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it is possible to configure how big a single node can be <span class="keyword">in</span> bytes, and the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maximum number of items it may contain before switching to a new node when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> appending new stream entries. If any of the following settings are <span class="built_in">set</span> to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> zero, the <span class="built_in">limit</span> is ignored, so <span class="keyword">for</span> instance it is possible to <span class="built_in">set</span> just a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> max entires <span class="built_in">limit</span> by setting max-bytes to 0 and max-entries to the desired</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> value.</span></span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Active rehashing uses 1 millisecond every 100 milliseconds of CPU time <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> order to <span class="built_in">help</span> rehashing the main Redis <span class="built_in">hash</span> table (the one mapping top-level</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> keys to values). The <span class="built_in">hash</span> table implementation Redis uses (see dict.c)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performs a lazy rehashing: the more operation you run into a <span class="built_in">hash</span> table</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that is rehashing, the more rehashing <span class="string">&quot;steps&quot;</span> are performed, so <span class="keyword">if</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server is idle the rehashing is never complete and some more memory is used</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by the <span class="built_in">hash</span> table.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The default is to use this millisecond 10 times every second in order to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> actively <span class="built_in">rehash</span> the main dictionaries, freeing memory when possible.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If unsure:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use <span class="string">&quot;activerehashing no&quot;</span> <span class="keyword">if</span> you have hard latency requirements and it is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not a good thing <span class="keyword">in</span> your environment that Redis can reply from time to time</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to queries with 2 milliseconds delay.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># use &quot;activerehashing yes&quot; if you don&#x27;t have such hard requirements but</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> want to free memory asap when possible.</span></span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The client output buffer limits can be used to force disconnection of clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that are not reading data from the server fast enough <span class="keyword">for</span> some reason (a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> common reason is that a Pub/Sub client can<span class="string">&#x27;t consume messages as fast as the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> publisher can produce them).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The limit can be set differently for the three different classes of clients:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># normal -&gt; normal clients including MONITOR clients</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica  -&gt; replica clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The syntax of every client-output-buffer-limit directive is the following:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># A client is immediately disconnected once the hard limit is reached, or if</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the soft <span class="built_in">limit</span> is reached and remains reached <span class="keyword">for</span> the specified number of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> seconds (continuously).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> So <span class="keyword">for</span> instance <span class="keyword">if</span> the hard <span class="built_in">limit</span> is 32 megabytes and the soft <span class="built_in">limit</span> is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 16 megabytes / 10 seconds, the client will get disconnected immediately</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> the size of the output buffers reach 32 megabytes, but will also get</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disconnected <span class="keyword">if</span> the client reaches 16 megabytes and continuously overcomes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the <span class="built_in">limit</span> <span class="keyword">for</span> 10 seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default normal clients are not limited because they don&#x27;t receive data</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> without asking (<span class="keyword">in</span> a push way), but just after a request, so only</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> asynchronous clients may create a scenario <span class="built_in">where</span> data is requested faster</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> than it can <span class="built_in">read</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Instead there is a default limit for pubsub and replica clients, since</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> subscribers and replicas receive data <span class="keyword">in</span> a push fashion.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Both the hard or the soft limit can be disabled by setting them to zero.</span></span></span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit replica 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Client query buffers accumulate new commands. They are limited to a fixed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> amount by default <span class="keyword">in</span> order to avoid that a protocol desynchronization (<span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instance due to a bug <span class="keyword">in</span> the client) will lead to unbound memory usage <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the query buffer. However you can configure it here <span class="keyword">if</span> you have very special</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> needs, such us huge multi/<span class="built_in">exec</span> requests or alike.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># client-query-buffer-limit 1gb</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> In the Redis protocol, bulk requests, that are, elements representing single</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> strings, are normally limited ot 512 mb. However you can change this <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> here, but must be 1mb or greater</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># proto-max-bulk-len 512mb</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis calls an internal <span class="keyword">function</span> to perform many background tasks, like</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> closing connections of clients <span class="keyword">in</span> timeout, purging expired keys that are</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> never requested, and so forth.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Not all tasks are performed with the same frequency, but Redis checks for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tasks to perform according to the specified <span class="string">&quot;hz&quot;</span> value.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># By default &quot;hz&quot; is set to 10. Raising the value will use more CPU when</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis is idle, but at the same time will make Redis more responsive when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> there are many keys expiring at the same time, and timeouts may be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> handled with more precision.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The range is between 1 and 500, however a value over 100 is usually not</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a good idea. Most users should use the default of 10 and raise this up to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 100 only <span class="keyword">in</span> environments <span class="built_in">where</span> very low latency is required.</span></span><br><span class="line">hz 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Normally it is useful to have an HZ value <span class="built_in">which</span> is proportional to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> number of clients connected. This is useful <span class="keyword">in</span> order, <span class="keyword">for</span> instance, to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avoid too many clients are processed <span class="keyword">for</span> each background task invocation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to avoid latency spikes.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Since the default HZ value by default is conservatively set to 10, Redis</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> offers, and enables by default, the ability to use an adaptive HZ value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">which</span> will temporary raise when there are many connected clients.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># When dynamic HZ is enabled, the actual configured HZ will be used</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as a baseline, but multiples of the configured HZ value will be actually</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used as needed once more clients are connected. In this way an idle</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instance will use very little CPU time <span class="keyword">while</span> a busy instance will be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> more responsive.</span></span><br><span class="line">dynamic-hz yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When a child rewrites the AOF file, <span class="keyword">if</span> the following option is enabled</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the file will be fsync-ed every 32 MB of data generated. This is useful</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to commit the file to the disk more incrementally and avoid</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> big latency spikes.</span></span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When redis saves RDB file, <span class="keyword">if</span> the following option is enabled</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the file will be fsync-ed every 32 MB of data generated. This is useful</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to commit the file to the disk more incrementally and avoid</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> big latency spikes.</span></span><br><span class="line">rdb-save-incremental-fsync yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> idea to start with the default settings and only change them after investigating</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> how to improve the performances and how the keys LFU change over time, <span class="built_in">which</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is possible to inspect via the OBJECT FREQ <span class="built_in">command</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># There are two tunable parameters in the Redis LFU implementation: the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> counter logarithm factor and the counter decay time. It is important to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> understand what the two parameters mean before changing them.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The LFU counter is just 8 bits per key, it&#x27;s maximum value is 255, so Redis</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> uses a probabilistic increment with logarithmic behavior. Given the value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of the old counter, when a key is accessed, the counter is incremented <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this way:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1. A random number R between 0 and 1 is extracted.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. The counter is incremented only <span class="keyword">if</span> R &lt; P.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The default lfu-log-factor is 10. This is a table of how the frequency</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> counter changes with a different number of accesses with different</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> logarithmic factors:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># +--------+------------+------------+------------+------------+------------+</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 0      | 104        | 255        | 255        | 255        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 1      | 18         | 49         | 255        | 255        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 10     | 10         | 18         | 142        | 255        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 100    | 8          | 11         | 49         | 143        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># <span class="doctag">NOTE:</span> The above table was obtained by running the following commands:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   redis-benchmark -n 1000000 incr foo</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   redis-cli object freq foo</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># NOTE 2: The counter initial value is 5 in order to give new objects a chance</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to accumulate hits.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The counter decay time is the time, in minutes, that must elapse in order</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> the key counter to be divided by two (or decremented <span class="keyword">if</span> it has a value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> less &lt;= 10).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The default value for the lfu-decay-time is 1. A Special value of 0 means to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> decay the counter every time it happens to be scanned.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># lfu-log-factor 10</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lfu-decay-time 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########################## ACTIVE DEFRAGMENTATION #######################</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># What is active defragmentation?</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -------------------------------</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Active (online) defragmentation allows a Redis server to compact the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> spaces left between small allocations and deallocations of data <span class="keyword">in</span> memory,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> thus allowing to reclaim back memory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Fragmentation is a natural process that happens with every allocator (but</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> less so with Jemalloc, fortunately) and certain workloads. Normally a server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restart is needed <span class="keyword">in</span> order to lower the fragmentation, or at least to flush</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> away all the data and create it again. However thanks to this feature</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> implemented by Oran Agra <span class="keyword">for</span> Redis 4.0 this process can happen at runtime</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> an <span class="string">&quot;hot&quot;</span> way, <span class="keyword">while</span> the server is running.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Basically when the fragmentation is over a certain level (see the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configuration options below) Redis will start to create new copies of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> values <span class="keyword">in</span> contiguous memory regions by exploiting certain specific Jemalloc</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> features (<span class="keyword">in</span> order to understand <span class="keyword">if</span> an allocation is causing fragmentation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and to allocate it <span class="keyword">in</span> a better place), and at the same time, will release the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> old copies of the data. This process, repeated incrementally <span class="keyword">for</span> all the keys</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will cause the fragmentation to drop back to normal values.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Important things to understand:</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 1. This feature is disabled by default, and only works if you compiled Redis</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    to use the copy of Jemalloc we ship with the <span class="built_in">source</span> code of Redis.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    This is the default with Linux builds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 2. You never need to enable this feature if you don&#x27;t have fragmentation</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    issues.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># 3. Once you experience fragmentation, you can enable this feature when</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    needed with the <span class="built_in">command</span> <span class="string">&quot;CONFIG SET activedefrag yes&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The configuration parameters are able to fine tune the behavior of the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> defragmentation process. If you are not sure about what they mean it is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a good idea to leave the defaults untouched.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enabled active defragmentation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> activedefrag no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Minimum amount of fragmentation waste to start active defrag</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-ignore-bytes 100mb</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Minimum percentage of fragmentation to start active defrag</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-threshold-lower 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maximum percentage of fragmentation at <span class="built_in">which</span> we use maximum effort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-threshold-upper 100</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Minimal effort <span class="keyword">for</span> defrag <span class="keyword">in</span> CPU percentage, to be used when the lower</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threshold is reached</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-cycle-min 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maximal effort <span class="keyword">for</span> defrag <span class="keyword">in</span> CPU percentage, to be used when the upper</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threshold is reached</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-cycle-max 25</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maximum number of <span class="built_in">set</span>/<span class="built_in">hash</span>/zset/list fields that will be processed from</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the main dictionary scan</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-max-scan-fields 1000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Jemalloc background thread <span class="keyword">for</span> purging will be enabled by default</span></span><br><span class="line">jemalloc-bg-thread yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible to pin different threads and processes of Redis to specific</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPUs <span class="keyword">in</span> your system, <span class="keyword">in</span> order to maximize the performances of the server.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is useful both <span class="keyword">in</span> order to pin different Redis threads <span class="keyword">in</span> different</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPUs, but also <span class="keyword">in</span> order to make sure that multiple Redis instances running</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the same host will be pinned to different CPUs.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Normally you can do this using the &quot;taskset&quot; command, however it is also</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> possible to this via Redis configuration directly, both <span class="keyword">in</span> Linux and FreeBSD.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># You can pin the server/IO threads, bio threads, aof rewrite child process, and</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the bgsave child process. The syntax to specify the cpu list is the same as</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the taskset <span class="built_in">command</span>:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Set redis server/io threads to cpu affinity 0,2,4,6:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server_cpulist 0-7:2</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Set bio threads to cpu affinity 1,3:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bio_cpulist 1,3</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Set aof rewrite child process to cpu affinity 8,9,10,11:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> aof_rewrite_cpulist 8-11</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Set bgsave child process to cpu affinity 1,10,11</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bgsave_cpulist 1,10-11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

</div><div class="article-licensing box"><div class="licensing-title"><p>redis配置文件详解</p><p><a href="https://mrhy1996.github.io/redis-config/">https://mrhy1996.github.io/redis-config/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>mrhy</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-05-14</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-05-17</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/redis/">redis</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/docker-clickhouse/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">docker安装clickhouse</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/linux-comand/"><span class="level-item">linux常用命令整理</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "qqrezpoLCiXy7GuUQlTP2NPv-gzGzoHsz",
            appKey: "KzzUdvfOAtTpDcAF5mv9nQsm",
            placeholder: "有什么话想对我说，写下来吧~",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-28T02:56:30.000Z">2021-07-28</time></p><p class="title"><a href="/oom/">oom问题</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-22T02:54:23.000Z">2021-07-22</time></p><p class="title"><a href="/threadPool/">线程池</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-11T05:58:15.000Z">2021-06-11</time></p><p class="title"><a href="/online/">java服务莫名挂掉的线上排查</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-05-27T02:34:11.000Z">2021-05-27</time></p><p class="title"><a href="/log4j2-conf-1/">Log4j2日志详解与配置1</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-05-25T05:20:52.000Z">2021-05-25</time></p><p class="title"><a href="/clickhouse-data-type/">clickhouse的基本数据类型</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">五月 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/clickhouse/"><span class="tag">clickhouse</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flink/"><span class="tag">flink</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jvm/"><span class="tag">jvm</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kafka/"><span class="tag">kafka</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log4j2/"><span class="tag">log4j2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring/"><span class="tag">spring</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%91%E6%8C%87offer/"><span class="tag">剑指offer</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%82%B9/"><span class="tag">基础知识点</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="tag">大数据</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%BA%90%E7%A0%81/"><span class="tag">源码</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98/"><span class="tag">线上问题</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">设计模式</span><span class="tag">5</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/daftpunktocat-thomas.gif" alt="mrhy1996"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">mrhy1996</p><p class="is-size-6 is-block">立志登山揽月</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国 · 上海</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">39</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">17</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Mrhy1996/" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Mrhy1996"><i class="fab fa-github"></i></a></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="mrhy&#039;s blogs" height="28"></a><p class="is-size-7"><span>&copy; 2021 mrhy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>